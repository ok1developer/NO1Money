<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"> <!-- Added user-scalable=no -->
    <title>ระบบยืนยันตัวตนระดับพรีเมียม | บริการไฟแนนซ์</title>
    <!-- Removed Prompt font, using LINESeedSansTH -->
    <!-- <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet"> -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <style>
        /* Added LINESeedSansTH font */
        @font-face {
          font-family: 'LINESeedSansTH';
          src: url('https://cdn.glitch.global/47bd20a5-ea68-4eee-b852-538d3eb2c0a4/LINESeedSansTH_W_Rg.woff?v=1729614138182') format('woff');
          font-weight: normal; /* 400 */
        }
        @font-face {
          font-family: 'LINESeedSansTH';
          src: url('https://cdn.glitch.global/47bd20a5-ea68-4eee-b852-538d3eb2c0a4/LINESeedSansTH_W_Bd.woff?v=1731156180172') format('woff');
          font-weight: bold; /* 700 */
        }
        /* You can add more weights (Thin, ExtraLight, Light, Regular, SemiBold, Bold, ExtraBold, Heavy) if needed */
        /* Example for SemiBold (600) - Use appropriate woff file */
        /* @font-face {
          font-family: 'LINESeedSansTH';
          src: url('path/to/LINESeedSansTH_W_Sb.woff') format('woff');
          font-weight: 600;
        } */


        :root {
            --primary-color: #9c27b0; /* Deep Purple */
            --primary-light: #ba68c8;
            --secondary-color: #7b1fa2; /* Darker Purple */
            --accent-color: #e91e63; /* Pink */
            --success-color: #4caf50; /* Green */
            --warning-color: #ff9800; /* Orange */
            --danger-color: #f44336; /* Red */
            --light-color: #f5f5f5;
            --dark-color: #212121;
            --gray-color: #757575;
            --info-color: #2196f3; /* Blue for info elements */
            --info-light: #e3f2fd;
            --border-radius: 16px; /* Slightly larger radius */
            --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
            --transition: all 0.3s ease-out; /* Faster transition */
            --glass-effect: rgba(255, 255, 255, 0.15);
            --pink-gradient: linear-gradient(135deg, #e91e63, #9c27b0);
            --purple-gradient: linear-gradient(135deg, #9c27b0, #673ab7);
            --gold-gradient: linear-gradient(135deg, #FFD700, #FFA500);
            --guide-color: #00BCD4; /* Cyan for guide elements */
            --guide-text-bg: rgba(0, 0, 0, 0.65); /* Darker background for guide text */
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent; /* Prevent tap highlight on mobile */
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            /* Use LINESeedSansTH as the primary font */
            font-family: 'LINESeedSansTH', 'Prompt', sans-serif;
            line-height: 1.7;
            color: var(--dark-color);
            background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
            min-height: 100vh;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for scroll */
            overflow-y: auto; /* Allow body scroll if content overflows */
            -webkit-font-smoothing: antialiased; /* Smoother fonts on WebKit */
            -moz-osx-font-smoothing: grayscale; /* Smoother fonts on Firefox */
        }

        .container {
            width: 100%;
            max-width: 100%; /* Full width on mobile */
            margin: 0 auto;
            perspective: 1000px;
        }

        .registration-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.98) 100%);
            border-radius: 0;
            box-shadow: none;
            overflow: hidden;
            margin-bottom: 0;
            position: relative;
            transform-style: preserve-3d;
            transition: var(--transition);
            backdrop-filter: blur(10px);
            border: none;
            min-height: 100vh;
            display: flex; /* Use flex for layout */
            flex-direction: column; /* Stack children vertically */
        }

        .card-header {
            background: var(--purple-gradient);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
            clip-path: polygon(0 0, 100% 0, 100% 90%, 0 100%);
            flex-shrink: 0; /* Prevent header from shrinking */
            padding-top: 40px; /* Added padding to compensate for removed progress steps */
            padding-bottom: 30px;
        }

        .card-header h1 {
            font-size: 24px;
            margin-bottom: 10px;
            position: relative;
            z-index: 1;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
            font-weight: bold; /* Use bold weight */
        }

        .card-header p {
            opacity: 0.9;
            font-size: 14px;
            position: relative;
            z-index: 1;
            max-width: 90%;
            margin: 0 auto;
        }

        .logo {
            width: 60px;
            height: 60px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
            z-index: 1;
        }

        .logo i {
            font-size: 28px;
            background: var(--pink-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .step-icon {
            margin-right: 8px;
        }

        h2, h3, h4 {
            font-weight: bold; /* Use bold for headings */
        }

        .card-body {
            padding: 20px;
            position: relative;
            flex-grow: 1; /* Allow body to take remaining space */
            overflow-y: auto; /* Allow scrolling within card body if needed */
            overflow-x: hidden; /* Prevent horizontal scroll */
        }

        .form-step {
            display: none;
            /* animation: fadeIn 0.5s ease-out; /* Will be handled by step transition classes */
        }

        .form-step.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); } /* Smaller translate */
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 20px;
            position: relative;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -8px; /* Smaller gap */
        }

        .form-col {
            flex: 1 1 100%; /* Default to full width */
            padding: 0 8px; /* Smaller gap */
        }

        @media (min-width: 600px) { /* Adjust breakpoint as needed */
             .form-col {
                 flex: 1 1 50%; /* Two columns on larger screens */
             }
        }


        label {
            display: block;
            margin-bottom: 8px; /* Smaller margin */
            font-weight: bold; /* Use bold for labels */
            color: var(--dark-color);
            font-size: 14px;
            position: relative;
        }

        .required-field::after {
            content: '*';
            color: var(--danger-color);
            margin-left: 4px;
            font-size: 16px;
        }

        input, select, textarea {
            width: 100%;
            padding: 14px 16px;
            border: 1px solid #ccc; /* Thinner border */
            border-radius: var(--border-radius);
            font-family: inherit; /* Inherit LINESeedSansTH */
            font-size: 16px;
            transition: var(--transition);
            background-color: #fff; /* White background */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.06); /* Subtle inset shadow */
            appearance: none; /* Remove default styling */
             -webkit-appearance: none;
             -moz-appearance: none;
        }
        /* Style select dropdown arrow */
         select {
             background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23757575' width='18px' height='18px'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
             background-repeat: no-repeat;
             background-position: right 16px center;
             background-size: 18px;
             padding-right: 40px; /* Space for arrow */
         }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(156, 39, 176, 0.15), inset 0 1px 3px rgba(0,0,0,0.06); /* Adjusted focus shadow */
            background-color: white;
        }
        /* Style for readonly inputs */
        input:read-only, textarea:read-only {
            background-color: #eee;
            cursor: not-allowed;
            opacity: 0.8;
            box-shadow: none;
        }

        .input-with-icon {
            position: relative;
        }

        .input-with-icon i.validation-icon { /* Specific class for validation icons */
            position: absolute;
            top: 50%;
            right: 16px;
            transform: translateY(-50%);
            color: var(--gray-color);
            transition: var(--transition);
            font-size: 18px;
             z-index: 2; /* Ensure icon is above input */
            pointer-events: none; /* Don't block input focus */
        }

        input:focus + i.validation-icon {
            color: var(--primary-color);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 14px 24px;
            background: var(--pink-gradient);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-family: inherit; /* Inherit LINESeedSansTH */
            font-size: 16px;
            font-weight: bold; /* Use bold for buttons */
            text-align: center;
            transition: var(--transition);
            box-shadow: 0 4px 10px rgba(156, 39, 176, 0.3);
            position: relative;
            overflow: hidden;
            width: 100%;
             -webkit-appearance: none; /* Remove default button styles on iOS */
        }

        .btn:hover:not(:disabled) { /* Add :not(:disabled) */
            background: var(--purple-gradient);
            transform: translateY(-2px); /* Smaller lift */
            box-shadow: 0 6px 12px rgba(156, 39, 176, 0.35); /* Adjusted shadow */
        }

        .btn:active:not(:disabled) { /* Add :not(:disabled) */
            transform: translateY(0);
             box-shadow: 0 3px 8px rgba(156, 39, 176, 0.25); /* Adjusted active shadow */
        }
        .btn:disabled {
             opacity: 0.6;
             cursor: not-allowed;
             background: var(--gray-color);
             box-shadow: none;
             transform: none;
         }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            box-shadow: none;
        }

        .btn-outline:hover:not(:disabled) { /* Add :not(:disabled) */
            background: rgba(156, 39, 176, 0.05); /* Lighter hover background */
            transform: translateY(-2px);
            color: var(--primary-color);
             box-shadow: 0 2px 5px rgba(156, 39, 176, 0.1); /* Add subtle shadow on hover */
        }
         .btn-outline:disabled {
             border-color: var(--gray-color);
             color: var(--gray-color);
             background: transparent;
             opacity: 0.6;
             cursor: not-allowed;
             transform: none;
             box-shadow: none;
         }

        /* Standard button group - Primary first */
        .btn-group {
            display: flex;
            flex-direction: column; /* Stack buttons */
            gap: 12px;
            margin-top: 30px;
        }


        .btn-block {
            display: block;
            width: 100%;
        }

        .upload-area {
            border: 2px dashed #bdbdbd;
            border-radius: var(--border-radius);
            padding: 25px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: 15px;
            background-color: rgba(255,255,255,0.7);
            position: relative;
            overflow: hidden;
             min-height: 150px; /* Ensure minimum height */
             display: flex;
             flex-direction: column;
             align-items: center;
             justify-content: center;
        }

        .upload-area:hover {
            border-color: var(--primary-color);
            background-color: rgba(156, 39, 176, 0.03); /* Even lighter hover */
        }
         .upload-area.dragover { /* Style when dragging over */
             border-color: var(--primary-color);
             background-color: rgba(156, 39, 176, 0.05);
             border-style: solid;
         }

        .upload-area i {
            font-size: 40px;
            color: var(--primary-color);
            margin-bottom: 15px;
            transition: var(--transition);
        }

        .upload-area p {
            margin-bottom: 10px;
            color: var(--dark-color);
            font-weight: bold; /* Use bold weight */
            font-size: 14px;
        }

        .upload-area small {
            color: var(--gray-color);
            font-size: 12px;
        }

        .preview-container {
            display: flex; /* Changed to flex for easier centering */
            justify-content: center; /* Center card horizontally */
            margin-top: 15px;
        }


        .preview-card {
            width: 100%; /* Full width for single card */
            max-width: 400px; /* Optional max width */
            border: 1px solid #e0e0e0; /* Thinner border */
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
            transition: var(--transition);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08); /* Slightly larger shadow */
            background: white;
        }
        /* Preview card for multiple items (like face captures) */
        .captured-faces-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px; /* Smaller gap */
            margin-top: 15px;
            justify-content: center; /* Center items */
        }
        .captured-faces-container .preview-card {
            width: calc(50% - 5px); /* Two cards per row with 10px gap */
            max-width: none; /* Remove max width for grid items */
        }
        @media (max-width: 480px) {
            .captured-faces-container .preview-card {
                width: calc(50% - 5px); /* Keep two per row on mobile if possible */
            }
        }
        @media (max-width: 360px) {
             .captured-faces-container .preview-card {
                 width: 100%; /* Single card per row on very small screens */
             }
        }


        .preview-image {
            width: 100%;
             aspect-ratio: 16 / 10; /* Adjust aspect ratio for ID cards/faces */
            object-fit: cover;
            border-bottom: 1px solid #eee;
            display: block; /* Remove extra space below image */
        }
        /* Style for video preview */
        #video-preview.preview-image {
            aspect-ratio: 16 / 9; /* Standard video aspect ratio */
            background-color: #000; /* Black background for video */
        }


        .preview-info {
            padding: 10px 12px; /* Smaller padding */
            background-color: white;
            text-align: center;
        }

        .preview-info p {
            font-size: 12px; /* Smaller font */
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: bold; /* Use bold weight */
            color: var(--dark-color);
            margin: 0; /* Remove default margin */
        }

        .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px; /* Slightly larger */
            height: 28px;
            background-color: rgba(244, 67, 54, 0.8); /* Slightly transparent */
            color: white;
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px; /* Adjust icon size */
            transition: var(--transition);
            opacity: 0.9;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
            z-index: 5; /* Ensure it's above preview image */
        }

        .remove-btn:hover {
            opacity: 1;
            transform: scale(1.1);
            background-color: var(--danger-color); /* Solid on hover */
        }

        .ocr-result {
            background-color: #f9f9f9; /* Lighter background */
            border-radius: var(--border-radius);
            padding: 20px; /* Increased padding */
            margin-top: 20px;
            border-left: 4px solid var(--primary-light); /* Lighter border color */
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .ocr-result h4 {
            margin-bottom: 15px; /* Increased margin */
            color: var(--primary-color);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px; /* Slightly larger */
            font-weight: bold; /* Bold */
        }

        .face-verification {
            text-align: center;
            margin-top: 20px; /* Reduced margin */
            background: #fff; /* White background */
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.08); /* Softer shadow */
        }

        .webcam-container {
            width: 100%;
            max-width: 480px; /* Max width for webcam */
            aspect-ratio: 4 / 3; /* Common webcam aspect ratio */
            margin: 0 auto 20px;
            border-radius: var(--border-radius);
            overflow: hidden;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            border: 1px solid #ddd; /* Thinner border */
            background-color: #212121; /* Background while loading */
        }
        @media (max-width: 480px) {
            .webcam-container {
                 aspect-ratio: 3 / 4; /* More portrait on mobile */
             }
        }

        #webcam-face, #webcam-video {
            width: 100%;
            height: 100%;
            object-fit: cover; /* Cover the container */
            display: block;
            transform: scaleX(-1); /* Mirror image */
        }

        .webcam-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: rgba(33, 33, 33, 0.6); /* Slightly darker */
            color: white;
            font-size: 16px;
            opacity: 0;
            transition: opacity 0.4s ease; /* Smoother transition */
            padding: 20px;
            text-align: center;
            pointer-events: none; /* Allow clicks through overlay */
            z-index: 1; /* Behind guides */
        }
         /* Show overlay when guide is active or on hover */
        .webcam-container.show-guide .webcam-overlay,
        .webcam-container:hover .webcam-overlay,
        .webcam-container.show-overlay .webcam-overlay { /* Class to force show */
             opacity: 1;
        }


        .capture-btn {
            margin: 15px auto;
            padding: 12px 30px;
            border-radius: 50px;
            font-weight: bold; /* Use bold weight */
            letter-spacing: 0.5px;
        }

        .hidden {
            display: none !important; /* Use important to override potential conflicts */
        }

        .status-pending {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: #fff8e1;
            color: #ff8f00;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: bold; /* Use bold weight */
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .status-approved {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background-color: #e8f5e9;
            color: #2e7d32;
            border-radius: var(--border-radius);
            font-size: 14px;
            font-weight: bold; /* Use bold weight */
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .otp-container {
            display: flex;
            justify-content: center;
            gap: 8px; /* Smaller gap */
            margin-top: 20px;
        }

        /* OTP Input Styling Adjustment */
        .otp-input {
            width: 48px; /* Adjusted size */
            height: 58px; /* Adjusted size */
            text-align: center;
            font-size: 22px; /* Slightly smaller font */
            border: 1px solid #ccc; /* Thinner border */
            border-radius: 12px; /* Smaller radius */
            transition: var(--transition);
            font-weight: bold; /* Use bold weight */
            color: var(--primary-color);
            padding: 0; /* Remove padding */
            line-height: 56px; /* Vertically center text */
            background-color: #fff;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.06);
            caret-color: var(--primary-color); /* Make caret visible */
             appearance: none; /* Remove default spinner */
             -webkit-appearance: none;
             -moz-appearance: textfield; /* Firefox */
        }
         /* Remove spinner buttons on number inputs */
         .otp-input::-webkit-outer-spin-button,
         .otp-input::-webkit-inner-spin-button {
             -webkit-appearance: none;
             margin: 0;
         }


        .otp-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(156, 39, 176, 0.15), inset 0 1px 3px rgba(0,0,0,0.06);
            outline: none;
            background-color: white;
        }

        .otp-input.filled {
            border-color: var(--primary-color); /* Use primary color when filled */
        }
         .otp-input.error { /* Style for incorrect OTP */
            border-color: var(--danger-color);
             animation: shake 0.4s; /* Add shake on error */
         }


        .resend-otp {
            margin-top: 15px;
            text-align: center;
            color: var(--gray-color);
            font-size: 14px;
        }

        .resend-otp a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold; /* Use bold weight */
            cursor: pointer;
            transition: var(--transition);
            position: relative;
        }
        .resend-otp a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }
        .resend-otp a.disabled { /* Style for disabled link */
             pointer-events: none;
             opacity: 0.5;
             text-decoration: none; /* Remove underline when disabled */
         }

        .security-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 15px;
            background-color: var(--info-light);
            color: #1565c0;
            border-radius: var(--border-radius);
            font-size: 13px;
            font-weight: bold; /* Use bold weight */
            border: 1px solid #bbdefb;
            margin-top: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .success-message {
            text-align: center;
            padding: 30px 20px;
            background: #fff; /* White background */
            border-radius: var(--border-radius);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin: 15px 0;
        }

        .success-message i.success-icon { /* Specific class for the icon */
            font-size: 60px;
            margin-bottom: 20px;
            color: var(--success-color); /* Use success color directly */
            display: inline-block;
        }

        .success-message h2 {
            margin-bottom: 15px;
            color: var(--primary-color);
            font-size: 22px;
            font-weight: bold; /* Use bold weight */
        }

        .success-message p {
            margin-bottom: 15px;
            color: var(--dark-color);
            font-size: 15px;
            line-height: 1.6;
            max-width: 100%;
            margin-left: auto;
            margin-right: auto;
        }

        /* Video Recording Section */
        .video-recording-container {
            margin-top: 25px; /* Adjusted margin */
            padding-top: 20px;
        }
         .video-recording-container h4 {
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: bold; /* Bolder heading */
         }

        .recording-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background-color: #ffebee;
            color: #c62828;
            border-radius: 20px;
            font-size: 13px;
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 4;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }
        .video-recording-container.active .recording-indicator {
            opacity: 1;
        }

        .recording-indicator .pulse-dot {
            width: 8px;
            height: 8px;
            background-color: #c62828;
            border-radius: 50%;
            animation: pulse-rec 1.5s infinite ease-in-out; /* Renamed animation */
        }
        @keyframes pulse-rec { /* Renamed animation */
            0%, 100% { box-shadow: 0 0 0 0 rgba(198, 40, 40, 0.7); }
            50% { box-shadow: 0 0 0 6px rgba(198, 40, 40, 0); }
        }

        /* Karaoke-style instruction container */
        #recording-instruction-container {
             position: absolute;
             bottom: 15px;
             left: 50%;
             transform: translateX(-50%);
             width: 90%;
             max-width: 450px;
             background-color: var(--guide-text-bg);
             padding: 10px 15px;
             border-radius: 8px;
             text-align: center;
             z-index: 3;
             pointer-events: none;
             color: white;
             font-weight: bold; /* Use bold weight */
             font-size: 16px;
             text-shadow: 0 1px 2px rgba(0,0,0,0.8);
             transition: opacity 0.3s ease, transform 0.3s ease;
             opacity: 0; /* Start hidden */
             /* transform: translateX(-50%) translateY(10px); // Removed transform transition */
         }
         /* Removed .active class dependency here, controlled by JS */
         #recording-instruction-container.visible {
             opacity: 1;
             transform: translateX(-50%) translateY(0);
         }
         @media (max-width: 480px) {
             #recording-instruction-container {
                font-size: 14px;
                padding: 8px 10px;
                bottom: 10px;
             }
         }

        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
        }

        .pdpa-agreement {
            background-color: #f9f9f9; /* Lighter */
            border: 1px solid #eee; /* Lighter border */
            border-radius: var(--border-radius);
            padding: 15px;
            margin: 20px 0; /* Add margin */
        }

        /* Scrollable container for PDPA text */
        .pdpa-scroll-container {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #fff;
            font-size: 14px;
            line-height: 1.6;
        }
        .pdpa-scroll-container h3 {
            font-size: 18px;
            color: var(--primary-color);
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold; /* Bold */
        }
        .pdpa-scroll-container h4 {
            font-size: 16px;
            color: var(--secondary-color);
            margin-top: 15px;
            margin-bottom: 10px;
            font-weight: bold; /* Bold */
        }
         .pdpa-scroll-container p, .pdpa-scroll-container li {
             margin-bottom: 10px;
             color: var(--dark-color);
         }
         .pdpa-scroll-container ul, .pdpa-scroll-container ol {
             padding-left: 25px; /* Standard indent */
             margin-left: 15px; /* Ensure lists are indented */
         }
        .pdpa-scroll-container strong {
             font-weight: bold; /* Use bold weight */
             color: var(--secondary-color);
         }
         /* Style for the list-like structure in section 5 */
         .pdpa-scroll-container .purpose-item {
             margin-bottom: 15px;
             padding-left: 5px;
         }
         .pdpa-scroll-container .purpose-item h4 {
             margin-top: 0;
             margin-bottom: 5px;
             font-size: 15px; /* Slightly smaller than regular h4 */
             color: var(--secondary-color);
         }
         .pdpa-scroll-container .purpose-item p {
             margin-bottom: 0;
             font-size: 14px;
         }
         /* Style for the list-like structure in section 10 */
         .pdpa-scroll-container .right-item {
             margin-bottom: 15px;
             padding-left: 5px;
         }
         .pdpa-scroll-container .right-item h4 {
             margin-top: 0;
             margin-bottom: 5px;
             font-size: 15px;
             color: var(--secondary-color);
         }
         .pdpa-scroll-container .right-item p {
             margin-bottom: 0;
             font-size: 14px;
         }

        .pdpa-checkbox {
            display: flex;
            align-items: flex-start; /* Align items to the start */
            margin-bottom: 12px;
        }

        /* Refined PDPA Checkbox Style */
        .pdpa-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
            margin-right: 12px;
            margin-top: 3px; /* Adjust vertical alignment */
            flex-shrink: 0;
            cursor: pointer;
            appearance: none;
            -webkit-appearance: none;
            background-color: #fff;
            border: 1px solid #ccc;
            border-radius: 4px;
            display: inline-block; /* Ensure it's an inline block */
            position: relative; /* Needed for absolute positioning of ::after */
            transition: background-color 0.2s, border-color 0.2s;
            vertical-align: top; /* Align with the top of the text */
        }

        .pdpa-checkbox input[type="checkbox"]:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        /* The checkmark */
        .pdpa-checkbox input[type="checkbox"]:checked::after {
            content: '';
            position: absolute;
            /* Adjust positioning carefully */
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid white;
            border-width: 0 2px 2px 0; /* Right and bottom borders */
            transform: rotate(45deg);
            display: block; /* Ensure it's displayed */
        }

        .pdpa-text {
            font-size: 14px;
            color: var(--dark-color);
            line-height: 1.6;
            cursor: pointer;
            flex-grow: 1; /* Allow text to take remaining space */
        }

        .pdpa-link {
            color: var(--primary-color);
            text-decoration: underline;
            font-weight: bold; /* Use bold weight */
        }

        .pdpa-link:hover {
            color: var(--secondary-color);
        }

        .flash-effect {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            opacity: 0;
            pointer-events: none;
            z-index: 1000;
            transition: opacity 0.3s;
        }

        .flash {
            animation: flash 0.5s;
        }

        @keyframes flash {
            0% { opacity: 0; }
            50% { opacity: 0.8; }
            100% { opacity: 0; }
        }

        .pin-code-container {
            margin-top: 15px;
        }

        .id-card-guide {
            background-color: var(--info-light);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            border-left: 4px solid var(--info-color);
        }

        .id-card-guide h4 {
            color: #1565c0;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 16px;
            font-weight: bold; /* Bold */
        }

        .id-card-guide ul {
            padding-left: 20px;
            margin-bottom: 0;
            list-style: disc;
        }

        .id-card-guide li {
            margin-bottom: 6px;
            font-size: 13px;
            color: #1e88e5;
        }

        .btn-3d {
            position: relative;
            transform-style: preserve-3d;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(156, 39, 176, 0.4);
        }

        .btn-3d:hover:not(:disabled) {
            transform: translateY(-3px) rotateX(5deg);
            box-shadow: 0 5px 15px rgba(156, 39, 176, 0.5);
        }

        .btn-3d:active:not(:disabled) {
            transform: translateY(0) rotateX(0);
            box-shadow: 0 3px 10px rgba(156, 39, 176, 0.4);
        }

        .otp-reference {
            background-color: #f5f5f5;
            border-radius: var(--border-radius);
            padding: 12px;
            margin-top: 15px;
            text-align: center;
            font-size: 13px;
            color: var(--gray-color);
            border: 1px solid #eee;
        }

        .otp-reference strong {
            color: var(--primary-color);
            font-weight: bold; /* Use bold weight */
        }

        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; /* Smoother shake */
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-3px, 0, 0); } /* Adjust shake intensity */
            40%, 60% { transform: translate3d(3px, 0, 0); }
        }

        @keyframes pulse { /* Keep original pulse for success check */
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Removed header close button style */
        /* .close-btn { ... } */

        .liff-header {
            position: relative;
        }

        .premium-badge {
            background: var(--gold-gradient);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold; /* Use bold weight */
            display: inline-block;
            margin-left: 8px;
            vertical-align: middle;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .input-label {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 8px;
        }

        .input-label i {
            color: var(--primary-color);
            width: 1.2em;
             text-align: center;
            font-size: 1.1em;
        }

        /* PIN Keypad Styling Improvements */
        .numeric-keyboard {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .numeric-key {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 55px;
            background-color: #fff;
            border-radius: var(--border-radius);
            font-size: 24px;
            font-weight: normal; /* Regular weight for numbers */
            cursor: pointer;
            transition: background-color 0.15s ease, transform 0.1s ease;
            user-select: none;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 5px rgba(0,0,0,0.07);
            color: var(--dark-color);
        }

        .numeric-key:hover { background-color: #f5f5f5; }
        .numeric-key:active {
            background-color: #eee;
            transform: scale(0.95);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        .numeric-key.backspace {
            font-size: 22px;
            color: var(--primary-color);
            background-color: #f9f9f9;
        }
         .numeric-key.backspace i { font-weight: bold; } /* Make icon bolder */
         .numeric-key.backspace:hover { background-color: #f0f0f0; }
         .numeric-key.backspace:active { background-color: #e8e8e8; }
        .numeric-key.placeholder {
            background-color: transparent;
            box-shadow: none;
            border: none;
            cursor: default;
            pointer-events: none;
        }

        .keyboard-container {
            background-color: #fdfdfd;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.08);
            border: 1px solid #f0f0f0;
        }

        .keyboard-title {
            text-align: center;
            margin-bottom: 15px;
            color: var(--gray-color);
            font-size: 14px;
            font-weight: bold; /* Use bold weight */
        }

        .pin-input-container { position: relative; }
        .pin-input-fields {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }
        .pin-input-field {
            width: 42px;
            height: 55px;
            border: 1px solid #ccc;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold; /* Use bold weight */
            transition: var(--transition), transform 0.2s ease;
            background-color: #fff;
        }
        .pin-input-field.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(156, 39, 176, 0.15);
             transform: scale(1.05);
        }
        .pin-input-field.filled { border-color: var(--primary-color); }
        .pin-input-dot {
            width: 12px;
            height: 12px;
            background-color: var(--dark-color);
            border-radius: 50%;
            opacity: 0;
            transition: opacity 0.2s ease-in-out, transform 0.2s ease;
            transform: scale(0.5);
        }
        .pin-input-field.filled .pin-input-dot {
             opacity: 1;
             transform: scale(1);
             animation: fillDot 0.2s ease-out forwards;
         }
        @keyframes fillDot { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .keyboard-note {
            text-align: center;
            font-size: 13px;
            color: var(--gray-color);
            margin-top: 15px;
        }

        /* Step Transition Animations */
        .form-step {
             /* Default state, ready for animation */
            opacity: 1;
            transform: translateX(0);
        }
         .form-step.slide-out-left { animation: slideOutLeft 0.4s ease-in forwards; }
         .form-step.slide-in-right { animation: slideInRight 0.4s ease-out forwards; }
         .form-step.slide-in-left { animation: slideInLeft 0.4s ease-out forwards; }
         .form-step.slide-out-right { animation: slideOutRight 0.4s ease-in forwards; }

        @keyframes slideInRight { from { opacity: 0; transform: translateX(40px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideOutLeft { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(-40px); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-40px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideOutRight { from { opacity: 1; transform: translateX(0); } to { opacity: 0; transform: translateX(40px); } }

        /* Mobile Adjustments Continued */
        @media (max-width: 480px) {
             .pdpa-checkbox input[type="checkbox"]:checked::after {
                 left: 5px; /* Adjust checkmark position */
                 top: 1px;
                 width: 4px;
                 height: 9px;
             }
            .pdpa-text { font-size: 13px; }
            .card-header h1 { font-size: 20px; }
            .card-header p { font-size: 13px; }
            .form-group { margin-bottom: 15px; }
            .btn { padding: 12px 20px; font-size: 15px; }
            .pdpa-scroll-container { max-height: 250px; font-size: 13px; }
            .ocr-result h4 { font-size: 16px; }
            input, select, textarea { font-size: 15px; padding: 12px 14px; }
            select { padding-right: 35px; background-size: 16px; }
            label { font-size: 13px; }
            .input-label i { font-size: 1em; }
            .security-badge { font-size: 12px; padding: 8px 12px; }
            .otp-reference { font-size: 12px; padding: 10px; }
            .resend-otp { font-size: 13px; }
            .success-message h2 { font-size: 20px; }
            .success-message p { font-size: 14px; }
             #recording-instruction-container { font-size: 14px; padding: 8px 10px; bottom: 10px; }
             .face-action-text { font-size: 16px; padding: 6px 8px; }
             .face-countdown-text { font-size: 24px; top: 60px; }
             .id-card-guide h4 { font-size: 15px; }
             .id-card-guide li { font-size: 12px; }
             .duplicate-warning { font-size: 12px; }
        }

        /* Camera Guide Styles */
        .camera-guide {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 2;
            background-color: rgba(0, 0, 0, 0.65); /* Darker overlay */
            display: flex; align-items: center; justify-content: center; flex-direction: column;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .camera-guide.visible { opacity: 1; }
        .guide-frame { /* General guide frame style */
            background-color: rgba(255, 255, 255, 0.05);
            position: relative; display: flex; align-items: center; justify-content: center;
            border: 3px dashed var(--guide-color); /* Thinner dashed line */
        }
        .guide-text { /* General text below frame */
            position: absolute; bottom: -45px; left: 50%; transform: translateX(-50%);
            width: 90%; text-align: center; color: white; font-weight: bold; /* Use bold weight */
            text-shadow: 0 1px 4px rgba(0,0,0,0.7); padding: 5px 10px;
            background-color: var(--guide-text-bg); border-radius: 4px; font-size: 14px;
        }

        /* ID Card Specific Guide */
        .id-card-frame { /* Rectangular frame */
            width: 85%; height: 58%; /* Aspect ratio closer to ID card */
            border: 3px dashed var(--guide-color);
            border-radius: 10px; pointer-events: none; z-index: 2;
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.65); /* Cutout effect */
        }
        .id-card-guide-text { /* Text inside the frame for ID card */
             position: absolute;
             bottom: 15px; /* Position inside */
             left: 50%; transform: translateX(-50%);
             width: 85%; text-align: center; color: white; font-weight: bold; /* Use bold weight */
             text-shadow: 0 1px 3px rgba(0,0,0,0.7); padding: 5px 8px;
             background-color: var(--guide-text-bg); border-radius: 4px;
             pointer-events: none; z-index: 3; font-size: 13px;
         }

        /* Face Specific Guide */
        .face-guide { /* Oval frame */
             position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
             width: 65%; height: 80%; border: 3px dashed var(--guide-color);
             border-radius: 50%; pointer-events: none; z-index: 2;
             box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.65); /* Cutout effect */
         }
         /* Text overlays for face capture actions */
        .face-action-text {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            width: 85%; text-align: center; color: white; font-weight: bold; /* Use bold weight */
            text-shadow: 0 1px 3px rgba(0,0,0,0.7); padding: 8px 10px;
            pointer-events: none; z-index: 3; font-size: 18px;
            background-color: var(--guide-text-bg); border-radius: 8px;
             transition: opacity 0.3s ease;
         }
         .face-countdown-text {
            position: absolute; top: 75px; left: 0; width: 100%;
            text-align: center; color: white; font-weight: bold; /* Use bold weight */
            text-shadow: 0 1px 4px rgba(0,0,0,0.7); padding: 0 20px;
            pointer-events: none; z-index: 3; font-size: 28px;
             transition: opacity 0.3s ease;
         }

        /* Duplicate Warning Styling */
        .duplicate-warning {
            color: var(--danger-color);
            font-size: 13px;
            margin-top: 6px; /* Slightly more space */
            display: none; /* Controlled by JS */
            align-items: center;
            gap: 5px;
            padding-left: 2px; /* Slight indent */
        }
        .duplicate-warning i { font-size: 14px; }

        /* Birthdate Fields Styling */
        .birthdate-fields { display: flex; gap: 10px; }
        .birthdate-field { flex: 1; }

        .text-muted { color: var(--gray-color); font-size: 14px; }

        /* Style for face capture section container */
        #face-capture-section { margin-bottom: 20px; }

        /* Style SweetAlert buttons */
        .swal2-confirm {
            font-weight: bold !important; /* Ensure confirm button is bold */
        }
        .swal2-cancel {
            font-weight: normal !important; /* Keep cancel button normal */
        }
    </style>
</head>
<body>
    <div class="flash-effect" id="flash-effect"></div>

    <div class="container">
        <div class="registration-card">
            <div class="card-header liff-header">
                <!-- Removed Close Button from header -->
                <!-- <div class="close-btn" id="close-btn" aria-label="ปิด">
                    <i class="fas fa-times"></i>
                </div> -->
                <div class="logo">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h1><i class="fas fa-user-shield step-icon"></i> ระบบยืนยันตัวตนระดับพรีเมียม <span class="premium-badge">PREMIUM</span></h1>
                <p>บริการทางการเงินที่ปลอดภัยและน่าเชื่อถือด้วยเทคโนโลยีล่าสุด</p>
            </div>

            <div class="card-body">
                <!-- Step 1: PDPA Agreement -->
                <div class="form-step active" id="step-1">
                    <h2><i class="fas fa-file-signature step-icon"></i> นโยบายความเป็นส่วนตัว (PDPA)</h2>
                    <p class="text-muted">กรุณาอ่านและยอมรับนโยบายความเป็นส่วนตัวก่อนดำเนินการต่อ</p>

                    <div class="pdpa-agreement">
                         <!-- Scrollable PDPA Text Container -->
                        <div class="pdpa-scroll-container" id="pdpa-full-text">
                            <!-- ################## START OF NEW PDPA CONTENT ################## -->
                            <h3>นโยบายการรักษาความมั่นคงปลอดภัยข้อมูลส่วนบุคคล และ ความเป็นส่วนตัวสำหรับลูกค้า (Privacy Policy)</h3>
                            <p>กลุ่มบริษัท โอเค นัมเบอร์ วัน และบริษัทในเครือ โอเค นัมเบอร์ วัน จำกัด</p>
                            <hr style="border: none; border-top: 1px solid #eee; margin: 15px 0;">

                            <p>กลุ่มบริษัท โอเค นัมเบอร์ วัน จำกัด และบริษัทในเครือ โอเค นัมเบอร์ วัน จำกัด (ต่อไปนี้จะเรียกรวมว่า “บริษัทฯ”) ตระหนักถึงความสำคัญและหน้าที่ภายใต้ พระราชบัญญัติคุ้มครองข้อมูลส่วนบุคคล พ.ศ.2562 โดยให้ความสำคัญในการเคารพสิทธิความเป็นส่วนตัว และมุ่งมั่นเป็นอย่างยิ่งที่จะคุ้มครองข้อมูลส่วนบุคคลของทุกท่านให้มีความปลอดภัย นโยบายคุ้มครองข้อมูลส่วนบุคคลฉบับนี้ ให้ใช้กับข้อมูลส่วนบุคคลของลูกค้า หรือผู้รับบริการต่างๆ ของบริษัทฯ เพื่อแจ้งและอธิบายให้ทราบว่า บริษัทฯ เก็บรวบรวมข้อมูลส่วนบุคคลของท่านอย่างไร ข้อมูลใดบ้างที่บริษัทฯ จัดเก็บ มีวัตถุประสงค์ใดในการประมวลผลข้อมูล มีการเปิดเผยข้อมูลของท่านอย่างไร มีมาตรการในการรักษาปกป้องข้อมูลของท่านอย่างไร รวมถึงสิทธิของท่านในฐานะเจ้าของข้อมูลส่วนบุคคล โดยมีรายละเอียดดังต่อไปนี้</p>

                            <h4>1. กลุ่มหรือประเภทของบุคคลที่บริษัทฯ ทำการเก็บรวบรวมข้อมูลส่วนบุคคล</h4>
                            <p>ภายใต้นโยบายคุ้มครองข้อมูลสวนบุคคลฉบับนี้กลุ่มหรือประเภทของบุคคลที่บริษัทฯ ทำการเก็บรวบรวมและประมวลผลข้อมูลส่วนบุคคลประกอบด้วย</p>
                            <ul>
                                <li><strong>ลูกค้า</strong> หมายถึง บุคคลที่ซื้อสินค้าและ/หรือใช้บริการจากบริษัทฯ และ/หรืออาจจะซื้อสินค้าและ/หรือใช้บริการจากบริษัทฯ หรือบุคคลอื่นใดที่มีลักษณะคล้าย เช่น ผู้เข้าร่วมกิจกรรม ผู้ใช้บริการเว็บไซต์ ผู้ใช้บริการแอปพลิเคชัน หรือ ผู้ที่ติดต่อเพื่อขอรับข้อมูลหรือขอรับบริการจากบริษัทฯ และบริษัทในเครือ เป็นต้น</li>
                                <li><strong>ผู้ที่เกี่ยวข้องกับลูกค้า</strong> หมายถึง บุคคลที่เกี่ยวข้องหรือเป็นตัวแทนของลูกค้า เช่น ผู้บริหาร กรรมการ พนักงาน ตัวแทน หรือบุคลากรใด ๆ ของลูกค้าซึ่งเป็นนิติบุคคล และรวมถึง ผู้ที่ข้อมูลส่วนบุคคลปรากฎในเอกสารต่าง ๆ ที่เกี่ยวข้องกับกระบวนการที่เกี่ยวข้อง อาทิ ผู้จัดการ ผู้สั่งซื้อ ผู้รับสินค้า และผู้สั่งจ่ายเช็ค เป็นต้น</li>
                            </ul>

                            <h4>2. คำนิยามและความหมายของข้อมูลส่วนบุคคล</h4>
                            <p>นโยบายคุ้มครองข้อมูลส่วนบุคคลฉบับนี้ คำหรือข้อความว่า</p>
                            <ul>
                                <li><strong>“กลุ่มบริษัท โอเค นัมเบอร์ วัน และบริษัทในเครือ โอเค นัมเบอร์ วัน จำกัด (OK Number One Group of Companies or OK Number One Group)”</strong> หมายถึง บริษัท โอเค นัมเบอร์ วัน จำกัด และบริษัทซึ่งบริษัท โอเค นัมเบอร์ วัน จำกัด ถือหุ้นไม่ว่าโดยทางตรงหรือทางอ้อม</li>
                                <li><strong>“บริษัทในเครือโอเค นัมเบอร์ วันหรือ บริษัท (Companies in OK Number One Group or OK Number One Group company/ companies or company)”</strong> หมายถึง บริษัทซึ่งบริษัท โอเค นัมเบอร์ วัน จำกัด ถือหุ้น ไม่ว่าโดย ทางตรงหรือทางอ้อม</li>
                                <li><strong>“เจ้าของข้อมูลส่วนบุคคล”</strong> หมายถึง บุคคลธรรมดาที่เป็นลูกค้าหรือผู้ที่เกี่ยวข้องกับลูกค้า ของบริษัทฯ โดยต่อไปในนโยบายนี้จะเรียกย่อว่า “เจ้าของข้อมูล”</li>
                                <li><strong>“ผู้ควบคุมข้อมูลส่วนบุคคล”</strong> หมายถึง บริษัทฯ ซึ่งมีอำนาจตัดสินใจเกี่ยวกับข้อมูลส่วนบุคคลนั้น ซึ่งได้รับข้อมูลส่วนบุคคลจากเจ้าของข้อมูลหรือให้บริการแก่เจ้าของข้อมูล หรือต้องทำหรือปฏิบัติตามสัญญากับเจ้าของข้อมูล ไม่ว่าจะทางตรงหรือทางอ้อมก็ตาม</li>
                                <li><strong>“ข้อมูลส่วนบุคคล” (Personal Data)</strong> หมายถึง ข้อมูลเกี่ยวกับบุคคลซึ่งทำให้สามารถระบุตัวบุคคลนั้นได้ ไม่ว่าทางตรงหรือทางอ้อม แต่ไม่รวมถึงข้อมูลของผู้ถึงแก่กรรม ตัวอย่างเช่น ชื่อ นามสกุล หมายเลขโทรศัพท์ ที่อยู่ อีเมล หมายเลขบัตรประจำตัวประชาชน เป็นต้น</li>
                                <li><strong>“ข้อมูลส่วนบุคคลที่มีความอ่อนไหว” (Sensitive Personal Data)</strong> หมายถึง หมายถึง ข้อมูลส่วนบุคคลที่กฎหมายกำหนดเป็นการเฉพาะ เช่น เชื้อชาติ ความคิดเห็นทางการเมือง ความเชื่อในลัทธิ ศาสนา หรือปรัชญา พฤติกรรมทางเพศ ประวัติอาชญากรรม ข้อมูลสุขภาพ ความพิการ ข้อมูลสหภาพแรงงาน ข้อมูลพันธุกรรม ข้อมูลชีวภาพ (Biometric) หรือข้อมูลอื่นใดในทำนองเดียวกันที่กฎหมายกำหนด ซึ่งบริษัทฯ ต้องดำเนินการด้วยความระมัดระวังเป็นพิเศษ โดยบริษัทฯ จะเก็บรวบรวม ใช้ และ/หรือเปิดเผยข้อมูลส่วนบุคคลที่มีความอ่อนไหว ต่อเมื่อได้รับความยินยอมโดยชัดแจ้งจากท่าน หรือในกรณีที่บริษัทฯ มีความจำเป็นต้องดำเนินการตามที่กฎหมายอนุญาต</li>
                            </ul>
                            <p>กรณีบริษัทฯ ได้รับสำเนาบัตรประจำตัวประชาชนของลูกค้า หรือบริษัทฯ นำข้อมูลของลูกค้าออกจากบัตรประจำตัวประชาชนด้วยวิธีการทางอิเล็กทรอนิกส์ เพื่อวัตถุประสงค์ในการพิสูจน์ตัวตนของลูกค้าที่สมัครใช้บริการ และ/หรือทำธุรกรรมใดๆ กับบริษัทฯ ข้อมูลที่ได้รับจะมีข้อมูลศาสนาด้วย ซึ่งถือว่าเป็นข้อมูลส่วนบุคคลที่มีความอ่อนไหว (Sensitive Personal Data) บริษัทฯ ไม่มีนโยบายจัดเก็บข้อมูลส่วนบุคคลที่มีความอ่อนไหวจากลูกค้า ยกเว้นในกรณีที่บริษัทฯ ได้รับความยินยอมจากลูกค้า ทั้งนี้บริษัทฯ จะกำหนดวิธีการจัดการตามแนวทางปฏิบัติ และเป็นไปตามที่กฎหมายอนุญาต</p>

                            <h4>3. วิธีที่บริษัทฯ เก็บรวบรวมและรับข้อมูลส่วนบุคคลของท่าน</h4>
                            <p>3.1 บริษัทฯ เก็บรวบรวมและรับข้อมูลส่วนบุคคลของท่านผ่านช่องทางต่าง ๆ ดังนี้</p>
                            <p style="padding-left: 15px;">3.1.1 ข้อมูลส่วนบุคคลที่ท่านให้ไว้กับบริษัทฯ โดยตรง</p>
                            <p style="padding-left: 15px;">ท่านอาจให้ข้อมูลส่วนบุคคลแก่บริษัทฯ โดยตรง เช่น</p>
                            <ul style="padding-left: 30px;">
                                <li>เมื่อท่านติดต่อสื่อสาร สอบถามข้อมูล ให้ความเห็นหรือคำติชมแก่บริษัทฯ ไม่ว่าจะเป็นการสื่อสารเป็นในรูปแบบลายลักษณ์อักษรหรือวาจา ผ่านทางเว็บไซต์ แอปพลิเคชัน โทรศัพท์ อีเมล โทรสาร ไปรษณีย์ การพบปะกันโดยตรง หรือโดยวิธีการอื่นใด</li>
                                <li>เมื่อท่านแสดงเจตนาเพื่อซื้อสินค้าหรือใช้บริการจากบริษัทฯ เข้าทำสัญญาค้าขายกับบริษัทฯ หรือส่งมอบเอกสารต่าง ๆ ซึ่งมีข้อมูลส่วนบุคคลปรากฎอยู่มาให้แก่บริษัทฯ</li>
                                <li>เมื่อท่านเข้าร่วมกิจกรรมทางการตลาด การจับสลากชิงโชค งานอีเว้นท์ หรือกิจกรรมอื่น ๆ ที่จัดขึ้นโดยหรือในนามของบริษัทฯ เป็นต้น</li>
                            </ul>
                            <p style="padding-left: 15px;">ทั้งนี้ ท่านจำเป็นต้องให้ข้อมูลที่ถูกต้อง ครบถ้วนตามความเป็นจริงแก่บริษัทฯ หรือตัวแทนของบริษัทที่ได้รับอนุญาตเพื่อประโยชน์ของท่านในการเข้าทำนิติกรรมใด ๆ กับบริษัทฯ ในกรณีเป็นที่สงสัยว่าข้อมูลที่บริษัทฯ ได้รับมาไม่ว่าจากท่านโดยตรงหรือจากบุคคลภายนอก บริษัทขอสงวนสิทธิ์ในการร้องขอเอกสารใด ๆ เพื่อตรวจสอบข้อมูลที่บริษัทฯ ได้รับ</p>
                            <p style="padding-left: 15px;">ในกรณีที่ท่านไม่ประสงค์จะให้ข้อมูลส่วนบุคคลของท่านกับบริษัทฯ หรือไม่อนุญาตให้บริษัทใช้ข้อมูลส่วนบุคคลของท่านไม่ว่าจะเป็นการไม่อนุญาตให้ใช้ข้อมูลตั้งแต่ครั้งแรกหรือเป็นการเพิกถอนความยินยอมในภายหลังก็ตาม บริษัทอาจไม่สามารถให้บริการท่านได้อย่างเต็มประสิทธิภาพอย่างที่พึงจะเป็น</p>

                            <p style="padding-left: 15px;">3.1.2 ข้อมูลส่วนบุคคลที่บริษัทฯ ได้รับมาจากบุคคลภายนอก</p>
                            <p style="padding-left: 15px;">บริษัทฯ อาจได้รับข้อมูลส่วนบุคคลของท่านมาจากบุคคลภายนอก เช่น</p>
                            <ul style="padding-left: 30px;">
                                <li>การเก็บข้อมูลจากผู้ให้บริการต่าง ๆ ของบริษัทฯ เช่น ผู้ให้บริการเว็บไซต์ ผู้ให้บริการแอปพลิเคชัน ผู้ให้บริการพื้นที่พาณิชย์อิเล็กทรอนิกส์ (E- Commerce) ผู้ให้บริการศูนย์บริการข้อมูลลูกค้า (Call Center) ผู้ให้บริการประชาสัมพันธ์และแนะนำสินค้า/บริการ หรือผู้ให้บริการรวบรวมข้อมูล ซึ่งท่านอนุญาตให้ผู้ให้บริการนั้น ๆ เก็บรวบรวมและเปิดเผยข้อมูลของท่านได้</li>
                                <li>บางกรณีบริษัทฯ อาจเก็บรวบรวมข้อมูลส่วนบุคคลของท่านจากแหล่งข้อมูลสาธารณะ แหล่งข้อมูลเกี่ยวกับธุรกิจของท่าน หรือแหล่งข้อมูลทางการค้า ไม่ว่าท่านจะเป็นผู้เปิดเผยข้อมูลส่วนบุคคลด้วยตนเองหรือได้ให้ความยินยอมแก่ผู้ใดในการเปิดเผยข้อมูลส่วนบุคคลของท่านดังกล่าว</li>
                            </ul>

                            <p>3.2. ในการเก็บรวบรวมข้อมูลส่วนบุคคลของท่าน ท่านจะได้รับการแจ้งถึงรายละเอียดต่าง ๆ ตามที่ระบุในประกาศฯ ฉบับนี้ซึ่งรวมถึงวัตถุประสงค์และฐานทางกฎหมายในการเก็บรวบรวม ใช้ เปิดเผย และ/หรือ ประมวลผลข้อมูลส่วนบุคคล ที่ได้กำหนดให้การประมวลผลข้อมูลส่วนบุคคลใดต้องได้รับความยินยอมจากท่าน บริษัทฯ จะขอความยินยอมโดยชัดแจ้งจากท่าน</p>
                            <p>3.3. กรณีที่บริษัทฯ เก็บรวบรวมข้อมูลส่วนบุคคลของท่านไว้ก่อนวันที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลในส่วนที่เกี่ยวข้องกับการเก็บรวบรวม ใช้ หรือเปิดเผยข้อมูลส่วนบุคคลมีผลใช้บังคับ บริษัทฯ จะเก็บรวบรวมและใช้ข้อมูลส่วนบุคคลของท่านต่อไปตามวัตถุประสงค์เดิมที่บริษัทฯ ได้แจ้งไว้แก่ท่านในการเก็บรวบรวมข้อมูลส่วนบุคคล ซึ่งท่านมีสิทธิที่จะยกเลิกความยินยอมได้ โดยติดต่อมายังบริษัทฯ ตามรายละเอียดการติดต่อที่ระบุไว้ในท้ายของประกาศฯ ฉบับนี้ ทั้งนี้บริษัทฯ ขอสงวนสิทธิในการพิจารณาคำขอยกเลิกความยินยอมของท่าน และดำเนินการตามฐานประมวลผลที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด</p>

                            <h4>4. ข้อมูลส่วนบุคคลที่ถูกเก็บรวบรวม</h4>
                            <p>ข้อมูลส่วนบุคคลของท่านที่ถูกเก็บรวบรวมและประมวลผลภายใต้นโยบายฯ ฉบับนี้ ไม่ว่าจะเป็นข้อมูลส่วนบุคคลที่ท่านให้ไว้กับบริษัทฯ โดยตรง หรือข้อมูลส่วนบุคคลที่บริษัทฯ เก็บรวบรวมจากท่านโดยอัตโนมัติ หรือข้อมูลส่วนบุคคลที่บริษัทฯ ได้รับมาจากบุคคลภายนอก ได้แก่</p>
                            <ul>
                                <li>4.1. ข้อมูลส่วนบุคคล เช่น ชื่อ นามสกุล ชื่อเล่น วัน/เดือน/ปีเกิด อายุ เพศ หมายเลขบัตรประจำตัวประชาชน รูปถ่าย ลายมือชื่อ เชื้อชาติ สัญชาติ รายได้ เป็นต้น</li>
                                <li>4.2. ข้อมูลการติดต่อ เช่น ที่อยู่ตามบัตรประจำตัวประชาชน ที่อยู่ตามทะเบียนบ้าน สถานที่จัดส่งสินค้า สถานที่จัดส่งใบแจ้งหนี้ หมายเลขโทรศัพท์ โทรสาร อีเมล ไอดีผู้ใช้สำหรับไลน์แอปพลิเคชัน (Line ID) และข้อมูลผู้ที่สามารถติดต่อได้ เป็นต้น</li>
                                <li>4.3. ข้อมูลเกี่ยวกับธุรกิจของลูกค้า เช่น รายละเอียดเกี่ยวกับร้านค้า หรือสถานประกอบการของลูกค้า (เช่น ชื่อ เลขทะเบียนสถานที่ตั้ง และข้อมูลการติดต่อ) เป็นต้น</li>
                                <li>4.4. ข้อมูลเกี่ยวกับธุรกรรมการซื้อขาย เช่น รหัสลูกค้า รายละเอียดการสั่งซื้อ (เช่น สินค้าที่ต้องการ จำนวน และคุณภาพ) และรายละเอียดการร้องเรียนเกี่ยวกับสินค้า (เช่น วันที่สั่งซื้อสินค้า ประเภทสินค้า สาขาที่เกี่ยวข้อง และปัญหาที่พบ) เป็นต้น</li>
                                <li>4.5. ข้อมูลเกี่ยวกับการชำระเงิน เช่น จำนวนเงิน วงเงินสินเชื่อ เงื่อนไขการชำระเงิน เลขที่บัญชี ข้อมูลส่วนบุคคลที่ปรากฎในใบแจ้งหนี้ ใบกำกับภาษี ใบเสร็จรับเงิน ใบสำคัญรับเงิน และใบหักบัญชีเงินฝาก เป็นต้น</li>
                                <li>4.6. ข้อมูลที่ใช้ประกอบเป็นหลักฐานในการลงทะเบียนเป็นลูกค้ากับบริษัทฯ หรือในการทำธุรกรรมต่าง ๆ เช่น ข้อมูลส่วนบุคคลที่ปรากฏในสำเนาบัตรประชาชน สำเนาทะเบียนบ้าน สำเนาใบเปลี่ยนชื่อนามสกุล สำเนาทะเบียนการค้า เอกสารเดินบัญชีธนาคาร สลิปเงินเดือน สำเนาใบอนุญาตประกอบกิจการโรงงาน แบบฟอร์มลงทะเบียน สำเนาเอกสารสิทธิที่ดิน ใบขอเปิดหน้าบัญชีลูกค้า หนังสือมอบอำนาจ สำเนาหนังสือรับรองบริษัท สำเนาภพ. 09/20 แผนที่ เอกสารที่เป็นหลักประกัน (ถ้ามี) (เช่น หนังสือค้ำประกันโดยธนาคาร (Bank Guarantee) และหนังสือค้ำประกันโดยบุคคล สัญญาซื้อขายหรือสัญญาอื่นใดที่เกี่ยวข้องกับธุรกรรม และใบส่งสินค้า เป็นต้น</li>
                                <li>4.7. ข้อมูลคอมพิวเตอร์ โดยบริษัทฯ หรือผู้ให้บริการที่ได้รับอนุญาตจากบริษัทฯ อาจมีการใช้คุกกี้ เว็บบีคอนส์ หรือ เทคโนโลยีอื่นใดในการเก็บข้อมูลเพื่อช่วยเหลือท่านให้สามารถใช้บริการและเข้าถึงการบริการได้รวดเร็วและปลอดภัยมากยิ่งขึ้น ซึ่งข้อมูลดังกล่าวนี้ รวมถึง IP address เว็บไซต์ที่นำท่านมาสู่เว็บไซต์ของบริษัท ระยะเวลาในการเยี่ยมชมเว็บไซต์ ข้อมูลการค้นหา ช่วงเวลาที่เยี่ยมชม หรือข้อมูลทางสถิติอื่นๆ</li>
                                <li>4.8. ข้อมูลอื่น ๆ เช่น พฤติกรรมหรือแนวโน้มในการซื้อสินค้าและ/หรือบริการ บันทึกเสียงการสนทนา และบันทึกภาพนิ่งและภาพเคลื่อนไหว เป็นต้น</li>
                            </ul>

                            <h4>5. วัตถุประสงค์ในการเก็บรวบรวม ใช้ เปิดเผยข้อมูลส่วนบุคคล</h4>
                            <p>บริษัทฯ ดำเนินการเก็บรวบรวม ใช้ หรือเปิดเผยข้อมูลส่วนบุคคลของท่าน โดยมีวัตถุประสงค์ภายใต้ฐานในการประมวลผลข้อมูล ดังต่อไปนี้</p>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">1.</span> เพื่อวัตถุประสงค์ในการลงทะเบียนการสมัครเป็นลูกค้าหรือเพื่อเปิดบัญชีลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานสัญญา (เป็นการประมวลผลข้อมูลส่วนบุคคลของลูกค้าหรือ บุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน บริษัทฯ จำเป็นต้องดำเนินการเพื่อใช้ตามคำขอของลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน สำหรับการลงทะเบียนเป็นลูกค้ารายใหม่หรือการเปิดบัญชี ลูกค้า ผ่านช่องทางที่บริษัทฯ กำหนด เป็นต้น), ฐานประโยชน์อันชอบด้วยกฎหมาย (ในกรณีที่ลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกันเป็นนิติบุคคล บริษัทฯ จะประมวลผลข้อมูลส่วนบุคคลของผู้ที่เกี่ยวข้องกับลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกันตามความจำเป็นเพื่อประโยชน์โดยชอบด้วยกฎหมายในการดำเนินธุรกิจของบริษัทฯ เช่น การจัดการบัญชี และการตรวจสอบเพื่อยืนยันตัวตนของ ลูกค้า เป็นต้น)</p>
                            </div>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">2.</span> เพื่อวัตถุประสงค์ในการวิเคราะห์ข้อมูลและสำรวจพฤติกรรมของลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานความยินยอม (การที่บริษัทฯ เป็นฝ่ายเข้าขอสัมภาษณ์ สำรวจ และสังเกตพฤติกรรมของลูกค้า เพื่อขอเก็บรวบรวมข้อมูลส่วนบุคคล หรือการซื้อข้อมูลส่วนบุคคลของลูกค้ามาจากบุคคลภายนอก เพื่อนำมาวิเคราะห์ข้อมูลและสำรวจพฤติกรรมของลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน บริษัทฯ จะ ดำเนินการโดยอาศัยความยินยอมที่ได้รับจากลูกค้า หรือบุคคล อื่นใดที่มีลักษณะคล้ายคลึงกันก่อนหรือในขณะที่เก็บข้อมูล)</p>
                            </div>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">3.</span> เพื่อวัตถุประสงค์ในการทำสัญญา และการวาง หลักประกัน</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานสัญญา (การประมวลผลข้อมูลส่วนบุคคลของลูกค้า หรือ บุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน เป็นการจำเป็นเพื่อการเข้าทำสัญญา และกระบวนการอื่นๆ ที่เกี่ยวข้องกับการเข้าทำสัญญา เช่น การตรวจสอบหลักฐานประกอบการทำสัญญา และการวางหลักประกัน เป็นต้น), ฐานประโยชน์อันชอบด้วยกฎหมาย (ในกรณีที่ลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกันเป็นนิติบุคคล การประมวลผลข้อมูลส่วนบุคคลของผู้ที่เกี่ยวข้องกับลูกค้าหรือของบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน เป็นการจำเป็นเพื่อประโยชน์โดยชอบด้วยกฎหมายในการดำเนินธุรกิจของบริษัทฯ เช่น การบริหารจัดการสัญญา การตรวจสอบยืนยันตัวตนของลูกค้า และการพิจารณาคุณสมบัติลูกค้า เป็นต้น)</p>
                            </div>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">4.</span> เพื่อวัตถุประสงค์ในการบริหารจัดการคำสั่งซื้อจากลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานสัญญา (การประมวลผลข้อมูลส่วนบุคคลของลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน เป็นความจำเป็นเพื่อปฏิบัติหน้าที่ตามสัญญาซื้อขายและบริการ ซึ่งลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกันเป็นคู่สัญญา เช่น การสั่งซื้อผ่านช่องทางใด ๆ ไม่ว่าจะเป็นช่องทางของบริษัทฯ โดยตรง หรือช่องทางของบุคคลที่สาม เช่น การสั่งซื้อ ณ จุดขาย ผ่านเว็บไซต์ หรือแอปพลิเคชัน หรือช่องทางอื่น ๆ เป็นต้น), ฐานประโยชน์อันชอบด้วยกฎหมาย (ในกรณีที่ลูกค้า หรือบุคคล อื่นในลักษณะคล้ายคลึงกันเป็นนิติบุคคล การประมวลผลข้อมูลส่วนบุคคลของผู้ที่เกี่ยวข้องกับลูกค้าหรือของบุคคลอื่นในลักษณะคล้ายคลึงกัน เป็นการจำเป็นเพื่อประโยชน์โดยชอบด้วยกฎหมายในการดำเนินธุรกิจของบริษัทฯ เช่น การบริหารจัดการคำสั่งซื้อจากลูกค้า และการตรวจสอบยืนยันตัวตนของลูกค้า เป็นต้น)</p>
                            </div>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">5.</span> เพื่อวัตถุประสงค์ในการจัดเตรียมสินค้าและ/ หรือบริการ และดำเนินการอื่นใดที่เกี่ยวข้อง</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานสัญญา (การประมวลผลข้อมูลส่วนบุคคลของลูกค้า หรือ บุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน เป็นการจำเป็นเพื่อปฏิบัติตามสัญญาซึ่งลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกันเป็นคู่สัญญา เช่น การจัดส่งสินค้า การวางบิล การยืนยันยอดหนี้ค้างชำระ และการจัดส่งใบเสร็จรับเงินให้แก่ลูกค้า หรือบุคคลอื่น ใดที่มีลักษณะคล้ายคลึงกัน เป็นต้น), ฐานประโยชน์อันชอบด้วยกฎหมาย (ในกรณีที่ลูกค้า หรือบุคคล อื่นใดที่มีลักษณะคล้ายคลึงกันเป็นนิติบุคคล การประมวลผล ข้อมูลส่วนบุคคลของผู้ที่เกี่ยวข้องกับลูกค้าหรือของบุคคลอื่นใดที่ มีลักษณะคล้ายคลึงกัน เป็นการจำเป็นเพื่อประโยชน์โดยชอบด้วยกฎหมายในการดำเนินธุรกิจของบริษัทฯ เช่น การ ติดต่อสื่อสารกับลูกค้า เป็นต้น)</p>
                            </div>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">6.</span> เพื่อวัตถุประสงค์ในการดำเนินการแก้ไขเปลี่ยนแปลงรายละเอียดเกี่ยวกับลูกค้าใน ระบบของบริษัทฯ</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานประโยชน์อันชอบด้วยกฎหมาย (การประมวลผลข้อมูลส่วนบุคคลของลูกค้า ผู้ที่เกี่ยวข้องกับลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน เป็นการจำเป็นเพื่อประโยชน์โดยชอบด้วยกฎหมายในการอำนวยความสะดวกแก่ลูกค้า ผู้ที่เกี่ยวข้องกับลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกันในการแก้ไข เปลี่ยนแปลงรายละเอียดเกี่ยวกับลูกค้าหรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน ในระบบของบริษัทฯ ให้มีความถูกต้อง เป็นปัจจุบัน สมบูรณ์ และไม่ก่อให้เกิดความเข้าใจผิด)</p>
                            </div>
                             <div class="purpose-item">
                                <h4><span style="font-weight:normal;">7.</span> เพื่อวัตถุประสงค์ในการรับเรื่องร้องเรียนจากลูกค้า ผู้ที่เกี่ยวข้องกับลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานประโยชน์อันชอบด้วยกฎหมาย (การประมวลผลข้อมูลส่วนบุคคลของลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน เป็นการจำเป็นเพื่อประโยชน์โดยชอบด้วยกฎหมายในการอำนวยความสะดวกแก่ลูกค้า ผู้ที่เกี่ยวข้องกับลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน ในการร้องเรียนหรือส่งข้อเสนอแนะจาก ลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน เพื่อเป็นการพัฒนาคุณภาพการให้บริการของบริษัทฯ)</p>
                            </div>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">8.</span> เพื่อวัตถุประสงค์ในการประชาสัมพันธ์ เสนอสินค้าและบริการ รวมถึงเพื่อกิจกรรมทางการตลาดของบริษัทฯ</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานความยินยอม (บริษัทฯ อาจดำเนินกิจกรรมทางการตลาดใด ๆ เพื่อการประชาสัมพันธ์มายังท่านหรือเป็นสาธารณะ เช่น การส่งข้อความเกี่ยวกับการสื่อสารทางการตลาด หรือการนำเสนอสินค้าและบริการให้แก่ลูกค้า การขอถ่ายภาพนิ่งหรือภาพเคลื่อนไหวของลูกค้า เพื่อนำไปประมวลภาพและประชาสัมพันธ์กิจกรรมการตลาดตามช่องทางสื่อต่าง ๆ บริษัทฯ จะดำเนินการโดยขอความยินยอม จากท่านก่อนหรือขณะที่ดำเนินกิจกรรม)</p>
                            </div>
                             <div class="purpose-item">
                                <h4><span style="font-weight:normal;">9.</span> เพื่อวัตถุประสงค์ในการวิเคราะห์การใช้งาน เว็บไซต์ แอปพลิเคชัน หรือช่องทางอื่น ๆ ของท่าน เพื่อพัฒนาคุณภาพการให้บริการของ บริษัทฯ หรือเพื่อวัตถุประสงค์ทางการตลาด</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานประโยชน์อันชอบด้วยกฎหมาย (การประมวลผลข้อมูลส่วนบุคคลของท่านจากการใช้งานเว็บไซต์ แอปพลิเคชัน หรือช่องทางอื่น ๆ เป็นการจำเป็นเพื่อประโยชน์ชอบด้วยกฎหมายของบริษัทฯ เพื่อดำเนินธุรกิจและการพัฒนาคุณภาพการให้บริการของบริษัทฯ เช่น การปรับปรุงเว็บไซต์ แอปพลิเคชัน หรือช่องทางอื่น ๆ การพัฒนาคุณภาพสินค้าและบริการ ตลอดจนการแก้ไขข้อบกพร่องและปัญหาต่าง ๆ ที่เกี่ยวข้องกับ สินค้าและบริการ), ฐานความยินยอม (ในกรณีที่บริษัทฯ เก็บรวบรวมและ ประมวลผลข้อมูลส่วนบุคคลของท่านเพื่อนำมาวิเคราะห์พฤติกรรมและทำโฆษณาแบบเจาะจงตามพฤติกรรมของท่าน หรือทำการตลาดแบบตรง หรือในกรณีที่กฎหมายว่าด้วยการ คุ้มครองข้อมูลส่วนบุคคลกำหนดให้ต้องได้รับความยินยอมจากท่าน บริษัทฯ จะดำเนินการโดยอาศัยความยินยอมที่ได้รับจากท่านก่อนหรือขณะที่ดำเนินการ)</p>
                            </div>
                             <div class="purpose-item">
                                <h4><span style="font-weight:normal;">10.</span> เพื่อวัตถุประสงค์ในการติดต่อสื่อสารกับลูกค้า หรือบุคคลอื่นใดที่มีลักษณะคล้ายคลึงกัน</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานประโยชน์อันชอบด้วยกฎหมาย (การประมวลผลข้อมูลส่วนบุคคลเป็นการจำเป็นเพื่อประโยชน์โดยชอบด้วยกฎหมาย ในการติดต่อสื่อสารกับท่านเกี่ยวกับการให้บริการต่าง ๆ ของบริษัทฯ เช่น การดำเนินการตามคำขอใช้บริการ การตอบข้อซักถาม หรือข้อเสนอแนะของท่าน เป็นต้น)</p>
                            </div>
                            <div class="purpose-item">
                                <h4><span style="font-weight:normal;">11.</span> เพื่อวัตถุประสงค์ในการปฏิบัติตามกฎหมายที่ เกี่ยวข้องกับธุรกิจของบริษัทฯ และคำสั่งโดยชอบด้วยกฎหมายของหน่วยงานของรัฐและเจ้าหน้าที่ที่เกี่ยวข้อง</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานกฎหมาย (เพื่อการปฏิบัติตามกฎหมายซึ่งบังคับใช้กับบริษัทฯ เช่น กฎหมายว่าด้วยภาษีอากร กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคล และคำสั่งโดยชอบด้วยกฎหมายของหน่วยงานของรัฐและเจ้าหน้าที่ที่เกี่ยวข้อง เช่น สำนักงานคณะกรรมการคุ้มครองข้อมูลส่วนบุคคล เป็นต้น)</p>
                            </div>
                             <div class="purpose-item">
                                <h4><span style="font-weight:normal;">12.</span> เพื่อวัตถุประสงค์ในการเรียกร้องสิทธิตาม กฎหมาย การปฏิบัติตามหรือการใช้สิทธิเรียกร้องตามกฎหมาย หรือการยกขึ้นต่อสู้ซึ่งสิทธิเรียกร้องของบริษัทฯ</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานประโยชน์อันชอบด้วยกฎหมาย (การประมวลผลข้อมูลส่วนบุคคลเป็นการจำเป็นเพื่อการปฏิบัติตาม หรือการใช้สิทธิเรียกร้องตามกฎหมาย หรือการยกขึ้นต่อสู้ซึ่งสิทธิเรียกร้องของบริษัทฯ ในขั้นตอนต่าง ๆ ตามกฎหมาย เช่น การสอบสวนและ/หรือการไต่สวนโดยเจ้าหน้าที่รัฐ การเตรียมคดี การดำเนินคดี และ/หรือการต่อสู้คดีในชั้นศาล เป็นต้น)</p>
                            </div>
                             <div class="purpose-item">
                                <h4><span style="font-weight:normal;">13.</span> เพื่อการดำเนินการใด ๆ ที่จำเป็นและเป็นประโยชน์ต่อท่าน หรือเกี่ยวข้องโดยตรงกับ วัตถุประสงค์ที่กำหนดใด ๆ ข้างต้น</h4>
                                <p><strong>ฐานประมวลผล:</strong> ฐานประโยชน์อันชอบด้วยกฎหมาย (การประมวลผลข้อมูลส่วนบุคคลเป็นการจำเป็นเพื่อประโยชน์อันชอบด้วยกฎหมายของบริษัทฯ ในการดำเนินการใด ๆ ที่จำเป็นของบริษัทฯ และ/หรือเป็นประโยชน์ต่อท่าน หรือเกี่ยวข้องโดยตรงกับวัตถุประสงค์ที่กำหนดข้างต้น หากเป็นกรณีที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนดให้การประมวลผลข้อมูลส่วนบุคคลใด ต้องได้รับความยินยอมจากท่าน บริษัทฯ จะขอความยินยอมโดยชัดแจ้งจากท่านก่อนหรือระหว่างการดำเนินการ)</p>
                            </div>
                             <div class="purpose-item">
                                <h4><span style="font-weight:normal;">14.</span> เพื่อวัตถุประสงค์อื่น ๆ ที่บริษัทฯ จะแจ้งให้ ท่านทราบ</h4>
                                <p>บริษัทฯ จะแจ้งให้ท่านทราบถึงวัตถุประสงค์อื่นใดอันเป็นเหตุให้บริษัทฯ ต้องประมวลผลข้อมูลส่วนบุคคลของท่าน นอกเหนือไปจากวัตถุประสงค์ตามที่ระบุไว้ข้างต้นหรือเมื่อบริษัทฯ มีการเปลี่ยนแปลงวัตถุประสงค์เดิมที่กำหนดไว้</p>
                                <p>ทั้งนี้ หากเป็นกรณีที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนดให้การประมวลผลข้อมูลส่วนบุคคลใดต้องได้รับความยินยอมจากท่าน บริษัทฯ จะขอความยินยอมโดยชัดแจ้งจากท่านก่อนหรือระหว่างการดำเนินการ</p>
                            </div>
                            <p>ทั้งนี้ บริษัทฯอาจเปิดเผยข้อมูลของท่านให้กับบุคคลภายนอกหรือบริษัทที่เกี่ยวข้องเพื่อให้ธุรกรรมของท่านสำเร็จลุล่วง และเพื่อให้เป็นไปตามข้อกำหนดทางกฎเกณฑ์และกฎหมายและคำร้องขอตามที่ทางบริษัทฯเห็นว่าจำเป็น นอกเหนือจากวัตถุประสงค์ในข้างต้นด้วย</p>
                            <p>เนื่องจากข้อมูลส่วนบุคคลของท่านที่บริษัทฯ จะดำเนินการประมวลผลเพื่อวัตถุประสงค์ที่กำหนดข้างต้น ในส่วนที่มีความเกี่ยวเนื่องกับการปฏิบัติตามกฎหมายหรือสัญญาหรือมีความจำเป็นเพื่อเข้าทำสัญญากับท่าน เป็นข้อมูลที่จำเป็นต่อการบรรลุวัตถุประสงค์ดังกล่าว หากท่านไม่ประสงค์ที่จะให้ข้อมูลส่วนบุคคลดังกล่าวแก่บริษัทฯ อาจมีผลกระทบทางกฎหมายหรืออาจทำให้บริษัทฯ ไม่สามารถปฏิบัติหน้าที่ภายใต้สัญญาที่ได้เข้าทำกับท่าน หรือไม่สามารถข้าทำสัญญากับท่านได้ตามแต่กรณีที่อาจเกิดขึ้นนั้น</p>
                            <p>ในกรณีดังกล่าวนี้ บริษัทฯ อาจมีความจำเป็นต้องปฏิเสธการเข้าทำสัญญากับท่าน หรือยกเลิกการซื้อขายหรือการให้บริการที่เกี่ยวข้องกับท่าน ไม่ว่าทั้งหมดหรือบางส่วน</p>

                            <h4>6. การเปิดเผยข้อมูลส่วนบุคคลของท่าน</h4>
                            <p>บริษัทฯ อาจเปิดเผยข้อมูลส่วนบุคคลของท่าน ภายใต้วัตถุประสงค์ที่กำหนดและตามหลักเกณฑ์ที่กฎหมายกำหนดให้แก่บุคคลและหน่วยงานดังต่อไปนี้</p>
                            <ul>
                                <li>6.1. เพื่อการประมวลผลข้อมูลส่วนบุคคลของท่าน กลุ่มบริษัท โอเค นัมเบอร์ วัน จำกัดหรือบริษัทในเครือบริษัท โอเค นัมเบอร์ วัน จำกัด หมายถึง ผู้บริหาร กรรมการ พนักงาน ลูกจ้าง และ/หรือบุคลากรภายในของบริษัทดังกล่าวเท่าที่เกี่ยวข้องและตามความจำเป็น</li>
                                <li>6.2. คู่ค้าทางธุรกิจ ผู้ให้บริการ และผู้ประมวลผลข้อมูลส่วนบุคคลที่บริษัทฯ มอบหมายหรือว่าจ้างให้ทำหน้าที่บริหารจัดการประมวลผลข้อมูลส่วนบุคคลให้แก่บริษัทฯ ในการให้บริการต่าง ๆ เช่น การให้บริการด้านเทคโนโลยีสารสนเทศ บริการเก็บบันทึกข้อมูล บริการชำระเงิน บริการวิเคราะห์ข้อมูล บริการทำการตลาด หรือบริการอื่น ใดที่อาจเป็นประโยชน์ต่อท่าน หรือเกี่ยวข้องกับการดำเนินธุรกิจของบริษัทฯ</li>
                                <li>6.3. บุคคลที่เกี่ยวข้องเป็นที่ปรึกษาของบริษัทฯ เช่น ที่ปรึกษากฎหมาย ผู้ตรวจสอบบัญชี หรือผู้เชี่ยวชาญอื่นใด ทั้งภายในและภายนอกของบริษัทฯ</li>
                                <li>6.4. หน่วยงานของรัฐที่มีหน้าที่กำกับดูแลตามกฎหมาย หรือที่ร้องขอให้เปิดเผยข้อมูลส่วนบุคคลโดยอาศัยอำนาจตามกฎหมาย หรือที่เกี่ยวข้องกับกระบวนการทางกฎหมาย หรือที่ได้รับอนุญาตตามกฎหมายที่เกี่ยวข้อง เช่น กรมสรรพากร กระทรวงพาณิชย์ คณะกรรมการอาหารและยา สำนักงานคุ้มครองผู้บริโภค สำนักงานคณะกรรมการคุ้มครองข้อมูลส่วนบุคคล เป็นต้น</li>
                                <li>6.5. บุคคลหรือหน่วยงานอื่นใดที่ท่านให้ความยินยอมให้เปิดเผยข้อมูลส่วนบุคคลของท่านต่อบุคคลหรือหน่วยงานนั้น ๆ เช่น การเปิดเผยการประมวลภาพกิจกรรมตามช่องทางสื่อต่าง ๆ ของบริษัทฯ ให้แก่ประชาชนทั่วไป</li>
                                <li>6.6. การเปิดเผยข้อมูลส่วนบุคคลของท่านให้กับบุคคลอื่น จะดำเนินการภายใต้วัตถุประสงค์ที่กำหนดหรือวัตถุประสงค์อื่นที่กฎหมายกำหนดให้กระทำได้เท่านั้น ในกรณีที่กฎหมายกำหนดว่าต้องได้รับความยินยอมจากท่าน บริษัทฯ จะขอความยินยอมจากท่านก่อนหรือระหว่างการดำเนินการ</li>
                                <li>6.7. ในการเปิดเผยข้อมูลส่วนบุคคลของท่านให้กับบุคคลอื่น บริษัทฯ จะจัดให้มีมาตรการที่เหมาะสมเพื่อคุ้มครองข้อมูลส่วนบุคคลที่ได้เปิดเผย และเพื่อปฏิบัติตามมาตรฐานและหน้าที่การคุ้มครองข้อมูลส่วนบุคคลตามที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด ทั้งนี้ ในกรณีที่บริษัทฯ ส่งหรือโอนข้อมูลส่วนบุคคลของท่านไปต่างประเทศ บริษัทฯ จะดำเนินการเพื่อทำให้แน่ใจว่าประเทศปลายทาง องค์การระหว่างประเทศ หรือผู้รับข้อมูลในต่างประเทศนั้นมีมาตรฐานการคุ้มครองข้อมูลส่วนบุคคลที่เพียงพอหรือเพื่อทำให้แน่ใจว่าการส่งหรือโอนข้อมูลส่วนบุคคลของท่านไปต่างประเทศเป็นไปตามหลักเกณฑ์ที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด โดยบริษัทฯ จะขอความยินยอมของท่านสำหรับการส่งหรือโอนข้อมูลส่วนบุคคลของท่านไปยังต่างประเทศดังกล่าว</li>
                            </ul>

                            <h4>7. การส่งหรือโอนข้อมูลส่วนบุคคลไปต่างประเทศ</h4>
                            <ul>
                                <li>บริษัทฯ อาจส่งหรือโอนข้อมูลส่วนบุคคลของท่านไปยังบริษัทในเครือหรือบุคคลอื่นในต่างประเทศในกรณีที่จำเป็นเพื่อการปฏิบัติตามสัญญาซึ่งท่านเป็นคู่สัญญา หรือเป็นการกระทำตามสัญญาระหว่างบริษัทฯกับบุคคลหรือนิติบุคคลอื่นเพื่อประโยชน์ของท่านหรือเพื่อใช้ในการดำเนินการตามคำขอของท่านก่อนเข้าทำสัญญา</li>
                                <li>บริษัทฯ อาจเก็บข้อมูลของท่านบนคอมพิวเตอร์เซิร์ฟเวอร์ หรือคลาวด์ ที่ให้บริการโดยบุคคลอื่น และอาจใช้โปรแกรมหรือแอปพลิเคชันของบุคคลอื่นในรูปแบบของ Software as a Service (SaaS) และ Platform as a Service (PaaS) ในการประมวลผลข้อมูลส่วนบุคคลของท่าน แต่บริษัทฯ จะไม่อนุญาตให้บุคคลที่ไม่เกี่ยวข้องสามารถเข้าถึงข้อมูลส่วนบุคคลได้ และจะกำหนดให้บุคคลอื่นเหล่านั้นต้องมีมาตรการคุ้มครองความมั่นคงปลอดภัยที่เหมาะสม</li>
                                <li>ในกรณีที่มีการส่งข้อมูลส่วนบุคคลของท่านไปยังต่างประเทศ บริษัทฯ จะใช้มาตรการที่เหมาะสมเพื่อทำให้มั่นใจได้ว่าข้อมูลส่วนบุคคลของท่านจะได้รับการคุ้มครองและท่านสามารถใช้สิทธิที่เกี่ยวข้องกับข้อมูลส่วนบุคคลของท่านได้ตามกฎหมาย รวมถึงบริษัทฯ จะกำหนดให้ผู้ที่ได้รับข้อมูลมีมาตรการปกป้องข้อมูลของท่านอย่างเหมาะสมและประมวลผลข้อมูลส่วนบุคคลดังกล่าวเท่าที่จำเป็นเท่านั้น และดำเนินการเพื่อป้องกันไม่ให้บุคคลอื่นใช้หรือเปิดเผยข้อมูลส่วนบุคคลโดยปราศจากอำนาจโดยมิชอบ</li>
                            </ul>

                            <h4>8. การเก็บรักษาและระยะเวลาในการเก็บรักษาข้อมูลส่วนบุคคลของท่าน</h4>
                            <p>บริษัทฯ จะเก็บรักษาข้อมูลส่วนบุคคลของท่านตามระยะเวลาที่จำเป็น ตามวัตถุประสงค์ที่กำหนดในการประมวลผลข้อมูลส่วนบุคคลนั้น โดยระยะเวลาก็บรักษาข้อมูลส่วนบุคคลจะเปลี่ยนแปลงไปโดยขึ้นอยู่กับวัตถุประสงค์ที่กำหนดในการประมวลผลข้อมูลส่วนบุคคลนั้น ๆ</p>
                            <p>นอกจากนี้ บริษัทฯ จะเก็บรักษาข้อมูลส่วนบุคคลเป็นระยะเวลาตามที่กฎหมายที่เกี่ยวข้องกำหนด (ถ้ามี) โดยคำนึงถึงอายุความตามกฎหมายสำหรับการดำเนินคดีที่อาจเกิดขึ้นจากหรือที่เกี่ยวข้องกับเอกสารหรือข้อมูลส่วนบุคคลที่บริษัทฯ เก็บรวบรวมไว้ในแต่ละรายการ และคำนึงถึงแนวปฏิบัติของบริษัทฯ และของภาคธุรกิจที่เกี่ยวข้องสำหรับข้อมูลส่วนบุคคลแต่ละประเภทเป็นสำคัญ</p>
                            <p>ในเบื้องต้นบริษัทฯ จะเก็บรักษาข้อมูลส่วนบุคคลของท่านเป็นระยะเวลาไม่เกิน 10 ปี นับแต่วันที่นิติสัมพันธ์ระหว่างท่านกับบริษัทฯ สิ้นสุดลง อย่างไรก็ดี บริษัทฯ อาจเก็บรักษาข้อมูลส่วนบุคคลของท่านเป็นระยะเวลาเกินกว่าระยะเวลาดังกล่าว หากกฎหมายอนุญาตหรือการเก็บรักษาข้อมูลส่วนบุคคลดังกล่าวจำเป็นต่อการก่อตั้งสิทธิเรียกร้องทางกฎหมายของบริษัทฯ</p>
                            <p>หลังจากครบกำหนดระยะเวลาดังกล่าวข้างต้น บริษัทฯ จะลบหรือทำลายข้อมูลส่วนบุคคลดังกล่าว จากการจัดเก็บหรือระบบของบริษัทฯ และของบุคคลอื่นซึ่งให้บริการแก่บริษัทฯ (ถ้ามี) หรือทำให้ข้อมูลส่วนบุคคลของท่านเป็นข้อมูลที่ไม่สามารถระบุตัวท่านได้ เว้นแต่จะเป็นกรณีที่บริษัทฯ สามารถเก็บรักษาข้อมูลส่วนบุคคลดังกล่าวได้ต่อไปตามที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลหรือกฎหมายอื่นที่เกี่ยวข้องกำหนด</p>

                            <h4>9. บริษัทฯ คุ้มครองข้อมูลส่วนบุคคลของท่านอย่างไร</h4>
                            <p>บริษัทฯ จะเก็บรักษาข้อมูลส่วนบุคคลของท่านไว้เป็นอย่างดีตามมาตรการเชิงเทคนิค (Technical Measure) และมาตรการเชิงบริหารจัดการ (Organizational Measure) เพื่อรักษาความปลอดภัยในการประมวลผลข้อมูลส่วนบุคคลที่เหมาะสม และเพื่อป้องกันการละเมิดข้อมูลส่วนบุคคล โดยบริษัทฯ ได้กำหนดนโยบาย ระเบียบ และหลักเกณฑ์ในการคุ้มครองข้อมูลส่วนบุคคล รวมถึงมาตรการเพื่อป้องกันไม่ให้ผู้รับข้อมูลไปจากบริษัทฯ ใช้ หรือเปิดเผยข้อมูลนอกวัตถุประสงค์ หรือโดยไม่มีอำนาจหรือโดยมิชอบ และบริษัทฯ ได้มีการปรับปรุงนโยบาย ระเบียบและหลักเกณฑ์ดังกล่าวเป็นระยะตามความจำเป็น และเหมาะสม นอกจากนี้ผู้บริหาร พนักงาน ผู้รับจ้าง ตัวแทน ที่ปรึกษา และผู้รับข้อมูลจากบริษัทฯ มีหน้าที่ต้องรักษาความลับของข้อมูลส่วนบุคคลตามมาตรการรักษาความลับที่บริษัทฯ กำหนด</p>

                            <h4>10. สิทธิของเจ้าของข้อมูล</h4>
                            <p>สิทธิในส่วนนี้หมายถึงสิทธิตามกฎหมายที่เกี่ยวกับข้อมูลส่วนบุคคลของท่าน ซึ่งท่านอาจขอใช้สิทธิเหล่านี้กับบริษัทฯ ภายใต้เงื่อนไขที่กฎหมายกำหนดและกระบวนการจัดการสิทธิของบริษัทฯ</p>
                            <div class="right-item">
                                <h4>1. สิทธิในการเข้าถึงข้อมูลส่วนบุคคล</h4>
                                <p>ท่านมีสิทธิในการเข้าถึงข้อมูลส่วนบุคคลของท่านและขอให้บริษัทฯ ทำสำเนาข้อมูลส่วนบุคคลดังกล่าวให้แก่ท่าน ทั้งนี้ ตามที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด</p>
                            </div>
                             <div class="right-item">
                                <h4>2. สิทธิในการโอนย้ายข้อมูลส่วนบุคคล</h4>
                                <p>ท่านมีสิทธิที่จะขอรับข้อมูลส่วนบุคคลเกี่ยวกับท่าน รวมถึงมีสิทธิขอให้ส่งหรือโอนข้อมูลส่วนบุคคลของท่านไปยังผู้ควบคุมข้อมูลส่วนบุคคลรายอื่น หรือตัวท่านเอง เว้นแต่โดยสภาพไม่สามารถทำได้ ทั้งนี้ ตามที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด</p>
                            </div>
                             <div class="right-item">
                                <h4>3. สิทธิในการคัดค้านการประมวลผลข้อมูลส่วนบุคคล</h4>
                                <p>ท่านมีสิทธิขอคัดค้านการประมวลผลข้อมูลส่วนบุคคลของท่านได้ ในกรณีที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด</p>
                            </div>
                             <div class="right-item">
                                <h4>4. สิทธิในการลบข้อมูลส่วนบุคคล</h4>
                                <p>ท่านอาจขอให้บริษัทฯ ลบ ทำลาย หรือทำให้ข้อมูลส่วนบุคคลของท่านเป็นข้อมูลที่ไม่สามารถระบุตัวบุคคลได้ในกรณีที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด</p>
                            </div>
                             <div class="right-item">
                                <h4>5. สิทธิในการระงับการใช้ข้อมูลส่วนบุคคล</h4>
                                <p>ท่านมีสิทธิขอให้บริษัทฯ ระงับการประมวลผลข้อมูลส่วนบุคคลของท่านในกรณีที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด</p>
                            </div>
                             <div class="right-item">
                                <h4>6. สิทธิในการแก้ไขข้อมูลส่วนบุคคลให้ถูกต้อง</h4>
                                <p>ท่านมีสิทธิขอแก้ไขข้อมูลส่วนบุคคลของท่านให้ถูกต้อง หากข้อมูลส่วนบุคคลของท่านนั้นไม่ถูกต้อง ไม่เป็นปัจจุบัน ไม่ครบถ้วนสมบูรณ์ หรือก่อให้เกิดความเข้าใจผิด</p>
                            </div>
                             <div class="right-item">
                                <h4>7. สิทธิที่จะเพิกถอนความยินยอม</h4>
                                <p>ในกรณีที่บริษัทฯ อาศัยความยินยอมของท่านในการประมวลผลข้อมูลส่วนบุคคลฯ ของท่าน ท่านมีสิทธิในการเพิกถอนความยินยอมในการประมวลผลข้อมูลส่วนบุคคลที่ท่านได้ให้ความยินยอมกับบริษัทฯ ได้</p>
                            </div>
                             <div class="right-item">
                                <h4>8. สิทธิในการยื่นข้อร้องเรียน</h4>
                                <p>หากท่านมีความกังวลหรือมีข้อสงสัยเกี่ยวกับแนวทางการปฏิบัติของบริษัทฯ เกี่ยวกับข้อมูลส่วนบุคคลของท่าน โปรดติดต่อบริษัทฯ โดยใช้รายละเอียดการติดต่อตามข้อ 13 ของประกาศฯ ฉบับนี้ ทั้งนี้ ในกรณีที่มีเหตุให้เชื่อได้ว่าบริษัทฯ ได้ทำการฝ่าฝืนกฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคล ท่านมีสิทธิยื่นข้อร้องเรียน ต่อคณะกรรมการผู้เชี่ยวชาญที่ได้รับการแต่งตั้งโดยคณะกรรมการคุ้มครองข้อมูลส่วนบุคคลตามระเบียบและวิธีการตามที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนด</p>
                            </div>
                            <p>ทั้งนี้บริษัทฯ ขอสงวนสิทธิในการพิจารณาคำร้องขอใช้สิทธิของท่าน โดยบริษัทฯ จะดำเนินการตามที่กฎหมายว่าด้วยการคุ้มครองข้อมูลส่วนบุคคลกำหนดไว้</p>
                            <p>การใช้สิทธิของท่านตามข้างต้นอาจถูกจำกัดภายใต้กฎหมายที่เกี่ยวข้อง และมีบางกรณีที่มีเหตุจำเป็นที่บริษัทฯ อาจปฏิเสธหรือไม่สามารถดำเนินการตามคำขอใช้สิทธิของท่านได้ เช่น บริษัทฯ จำเป็นต้องปฏิบัติตามกฎหมายหรือคำสั่งศาล หรือการใช้สิทธินั้นๆ อาจละเมิดสิทธิหรือเสรีภาพของบุคคลอื่น หรือบริษัทฯ จำเป็นต้องใช้สิทธิเรียกร้องตามกฎหมายที่เกี่ยวข้องในการเก็บรักษาข้อมูลดังกล่าว โดยบริษัทฯ จะแจ้งเหตุผลของการปฏิเสธให้ท่านทราบ</p>
                            <p>หากท่านต้องการใช้สิทธิตามข้างต้น ท่านสามารถยื่นคำขอมายังบริษัทฯ</p>
                            <p>ในกรณีที่มีการละเมิดข้อมูลส่วนบุคคล ให้ผู้ควบคุมข้อมูลนั้นแจ้งต่อ หัวหน้าหน่วยงาน ภายใน 24 ชั่วโมง โดยให้ทำการสรุปสาเหตุ ร่วมกับส่วนงานที่เกี่ยวข้อง ภายใน 24 ชม. และ ส่งข้อมูลต่อเจ้าหน้าที่คุ้มครองข้อมูลส่วนบุคคล (Data Protection Officer: DPO) ภายใน 24 ชั่วโมง เพื่อแจ้งและประสาน หน่วยงานกำกับ PDPA ที่เกี่ยวข้อง (โดยทั้งหมดไม่เกิน 72 ชั่วโมง นับตั้งแต่ทราบเรื่อง)</p>

                            <h4>11. ขอบเขตของประกาศเกี่ยวกับคุ้มครองข้อมูลส่วนบุคคล</h4>
                            <p>ประกาศเกี่ยวกับการคุ้มครองข้อมูลส่วนบุคคลฉบับนี้ ใช้เฉพาะการให้บริการของบริษัทฯ เท่านั้น ในกรณีที่ท่านเชื่อมต่อไปยังแพลตฟอร์มของบริษัทอื่น แม้จะเป็นการเชื่อมต่อผ่านลิงก์ที่อยู่ในเว็บไซต์ของบริษัทฯ ก็ตาม นโยบายคุ้มครองข้อมูลส่วนบุคคลฉบับนี้จะไม่มีผลผูกพัน ท่านจำเป็นต้องศึกษาและปฏิบัติตามนโยบายคุ้มครองข้อมูลส่วนบุคคลที่ปรากฏบนแพลตฟอร์มเหล่านั้น และบริษัทฯ จะไม่รับผิดชอบเกี่ยวกับการดำเนินการต่าง ๆ ของแพลตฟอร์มอื่นนั้นทั้งสิ้น</p>

                            <h4>12. การเปลี่ยนแปลงนโยบายคุ้มครองข้อมูลส่วนบุคคล</h4>
                            <p>บริษัทฯ จะทำการพิจารณาทบทวนนโยบายคุ้มครองข้อมูลส่วนบุคคลเป็นประจำเพื่อให้สอดคล้องกับแนวทางปฏิบัติ และกฎหมาย ข้อบังคับที่เกี่ยวข้อง ทั้งนี้ หากมีการเปลี่ยนแปลงนโยบายคุ้มครองข้อมูลส่วนบุคคล บริษัทฯ จะแจ้งให้ท่านทราบโดยการประกาศข้อมูลลงในเว็บไซต์ของบริษัทฯ</p>

                            <h4>13. ช่องทางการติดต่อบริษัทฯ และเจ้าหน้าที่คุ้มครองข้อมูลส่วนบุคคล</h4>
                            <p>ท่านสามารถติดต่อบริษัทฯ เพื่อเสนอแนะ หรือสอบถามรายละเอียดเพิ่มเติมเกี่ยวกับนโยบายคุ้มครองข้อมูลส่วนบุคคลได้ที่</p>
                            <p><strong>บริษัท โอเค นัมเบอร์ วัน จำกัด</strong></p>
                            <p><strong>13.1 เจ้าหน้าที่คุ้มครองข้อมูลส่วนบุคคล DPO (Data Protection Officer)</strong><br>
                            เลขที่1อาคารศูนย์การค้าเซ็นเตอร์วัน ซอย เลิศปัญญา ถนนราชวิถี แขวงถนนพญาไท เขตราชเทวี กรุงเทพมหานคร 10400<br>
                            E-mail: dpo@no1.email<br>
                            Tel: 02-127-0010</p>
                            <p><strong>13.2 ผู้ควบคุมข้อมูลส่วนบุคคล (Data Controller)</strong><br>
                            บริษัท โอเค นัมเบอร์ วัน จำกัด<br>
                            เลขที่1อาคารศูนย์การค้าเซ็นเตอร์วัน ซอย เลิศปัญญา ถนนราชวิถี แขวงถนนพญาไท เขตราชเทวี กรุงเทพมหานคร 10400<br>
                            E-mail: pdpa@no1.email<br>
                            Tel: 02-127-0010</p>
                            <!-- ################## END OF NEW PDPA CONTENT ################## -->
                        </div><!-- End pdpa-scroll-container -->

                        <!-- Checkbox Section -->
                         <div class="pdpa-checkbox">
                             <input type="checkbox" id="pdpa-agreement" name="pdpa_agreement" value="accepted" required>
                             <label for="pdpa-agreement" class="pdpa-text">ข้าพเจ้าได้อ่านและเข้าใจ <a href="#" class="pdpa-link" onclick="document.getElementById('pdpa-full-text').parentNode.classList.toggle('hidden'); return false;">นโยบายความเป็นส่วนตัว</a> ฉบับนี้แล้ว และยินยอมให้บริษัทเก็บรวบรวม ใช้ และเปิดเผยข้อมูลส่วนบุคคลของข้าพเจ้าตามวัตถุประสงค์ที่ระบุไว้</label>
                         </div>
                         <div class="pdpa-checkbox">
                             <input type="checkbox" id="marketing-consent" name="marketing_consent" value="accepted">
                             <label for="marketing-consent" class="pdpa-text">ข้าพเจ้ายินยอมรับข้อมูลข่าวสาร โปรโมชั่น และข้อเสนอพิเศษต่างๆ จากบริษัทและบริษัทในกลุ่ม (เลือกได้)</label>
                         </div>

                    </div><!-- End pdpa-agreement -->

                     <!-- Button Group: Primary first -->
                    <div class="btn-group">
                        <button type="button" class="btn next-step btn-3d" id="accept-pdpa-btn" data-next="2" disabled>ยอมรับและดำเนินการต่อ <i class="fas fa-arrow-right"></i></button>
                        <!-- No Back button on first step -->
                    </div>

                    <div class="security-badge">
                        <i class="fas fa-lock"></i>
                        <span>ข้อมูลของคุณจะถูกเก็บเป็นความลับและปลอดภัยด้วยระบบ SSL</span>
                    </div>
                </div>

                <!-- Step 2: PIN Code Setup -->
                <div class="form-step" id="step-2">
                    <h2><i class="fas fa-key step-icon"></i> ตั้งรหัส PIN</h2>
                    <p class="text-muted">กรุณาตั้งรหัส PIN 6 หลักสำหรับใช้ในการเข้าสู่ระบบ</p>

                    <div class="form-group pin-code-container">
                        <label class="input-label required-field">
                            <i class="fas fa-lock"></i>
                            <span>รหัส PIN (6 หลัก)</span>
                        </label>

                        <div class="pin-input-container">
                             <!-- PIN Display Fields -->
                            <div class="pin-input-fields">
                                <div class="pin-input-field" data-index="0"> <div class="pin-input-dot"></div> </div>
                                <div class="pin-input-field" data-index="1"> <div class="pin-input-dot"></div> </div>
                                <div class="pin-input-field" data-index="2"> <div class="pin-input-dot"></div> </div>
                                <div class="pin-input-field" data-index="3"> <div class="pin-input-dot"></div> </div>
                                <div class="pin-input-field" data-index="4"> <div class="pin-input-dot"></div> </div>
                                <div class="pin-input-field" data-index="5"> <div class="pin-input-dot"></div> </div>
                            </div>

                            <!-- Enhanced Keyboard Container -->
                            <div class="keyboard-container">
                                <div class="keyboard-title">กรุณากดรหัส PIN บนแป้นพิมพ์</div>
                                <div class="numeric-keyboard">
                                    <div class="numeric-key" data-value="1">1</div>
                                    <div class="numeric-key" data-value="2">2</div>
                                    <div class="numeric-key" data-value="3">3</div>
                                    <div class="numeric-key" data-value="4">4</div>
                                    <div class="numeric-key" data-value="5">5</div>
                                    <div class="numeric-key" data-value="6">6</div>
                                    <div class="numeric-key" data-value="7">7</div>
                                    <div class="numeric-key" data-value="8">8</div>
                                    <div class="numeric-key" data-value="9">9</div>
                                    <div class="numeric-key placeholder"></div> <!-- Styled Placeholder -->
                                    <div class="numeric-key" data-value="0">0</div>
                                    <div class="numeric-key backspace" data-action="backspace">
                                        <i class="fas fa-delete-left"></i> <!-- Changed Icon -->
                                    </div>
                                </div>
                                <div class="keyboard-note">ห้ามเปิดเผยรหัส PIN ให้ผู้อื่นทราบ</div>
                            </div>
                        </div>
                    </div>

                    <!-- Button Group: Primary first -->
                    <div class="btn-group">
                        <button type="button" class="btn next-step btn-3d" id="confirm-pin-btn" data-next="3" disabled>ยืนยันรหัส PIN <i class="fas fa-check"></i></button>
                        <button type="button" class="btn btn-outline prev-step" data-prev="1"><i class="fas fa-arrow-left"></i> ย้อนกลับ</button>
                    </div>
                </div>

                <!-- Step 3: Basic Information -->
                <div class="form-step" id="step-3">
                    <h2><i class="fas fa-user-edit step-icon"></i> ข้อมูลเบื้องต้น</h2>
                    <p class="text-muted">กรุณากรอกข้อมูลพื้นฐานเพื่อเริ่มกระบวนการยืนยันตัวตน</p>

                    <div class="form-group">
                        <label class="input-label required-field" for="phone">
                            <i class="fas fa-phone"></i>
                            <span>หมายเลขโทรศัพท์</span>
                        </label>
                        <div class="input-with-icon">
                            <input type="tel" id="phone" placeholder="เช่น 0812345678" maxlength="10" inputmode="numeric">
                            <i class="fas fa-check-circle validation-icon hidden" id="phone-valid-icon" style="color: var(--success-color);"></i>
                        </div>
                        <small class="text-muted">ระบบจะส่ง OTP ไปยังหมายเลขนี้เพื่อยืนยัน</small>
                         <!-- Warning will be shown by JS only when needed -->
                        <div class="duplicate-warning" id="phone-warning">
                            <i class="fas fa-exclamation-circle"></i> หมายเลขโทรศัพท์นี้ถูกใช้งานแล้ว
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="input-label required-field" for="id-number">
                             <i class="fas fa-id-card"></i>
                             <span>เลขบัตรประชาชน</span>
                         </label>
                        <div class="input-with-icon">
                            <input type="text" id="id-number" placeholder="เช่น 1234567890123" maxlength="13" inputmode="numeric">
                            <i class="fas fa-check-circle validation-icon hidden" id="id-valid-icon" style="color: var(--success-color);"></i>
                        </div>
                         <!-- Warning will be shown by JS only when needed -->
                         <div class="duplicate-warning" id="id-warning">
                             <i class="fas fa-exclamation-circle"></i> รูปแบบเลขบัตรประชาชนไม่ถูกต้อง
                         </div>
                    </div>

                    <div class="form-group">
                        <label class="input-label required-field">
                            <i class="fas fa-birthday-cake"></i>
                            <span>วันเดือนปีเกิด (พ.ศ.)</span>
                        </label>
                        <div class="birthdate-fields">
                            <div class="birthdate-field">
                                <select id="birth-day" class="form-control" aria-label="เลือกวันเกิด">
                                    <option value="" selected disabled>วัน</option>
                                </select>
                            </div>
                            <div class="birthdate-field">
                                <select id="birth-month" class="form-control" aria-label="เลือกเดือนเกิด">
                                    <option value="" selected disabled>เดือน</option>
                                    <option value="1">มกราคม</option>
                                    <option value="2">กุมภาพันธ์</option>
                                    <option value="3">มีนาคม</option>
                                    <option value="4">เมษายน</option>
                                    <option value="5">พฤษภาคม</option>
                                    <option value="6">มิถุนายน</option>
                                    <option value="7">กรกฎาคม</option>
                                    <option value="8">สิงหาคม</option>
                                    <option value="9">กันยายน</option>
                                    <option value="10">ตุลาคม</option>
                                    <option value="11">พฤศจิกายน</option>
                                    <option value="12">ธันวาคม</option>
                                </select>
                            </div>
                            <div class="birthdate-field">
                                <select id="birth-year" class="form-control" aria-label="เลือกปีเกิด พ.ศ.">
                                    <option value="" selected disabled>ปี</option>
                                </select>
                            </div>
                        </div>
                        <div class="duplicate-warning" id="birthdate-warning" style="display: none;">
                            <i class="fas fa-exclamation-circle"></i> อายุต้องอยู่ระหว่าง 18-65 ปี หรือ วันที่ไม่ถูกต้อง
                        </div>
                    </div>

                    <!-- Button Group: Primary first -->
                    <div class="btn-group">
                        <button type="button" class="btn next-step btn-3d" id="send-otp-btn" data-next="4" disabled>ส่ง OTP <i class="fas fa-paper-plane"></i></button>
                        <button type="button" class="btn btn-outline prev-step" data-prev="2"><i class="fas fa-arrow-left"></i> ย้อนกลับ</button>
                    </div>
                </div>

                <!-- Step 4: OTP Verification -->
                <div class="form-step" id="step-4">
                    <h2><i class="fas fa-sms step-icon"></i> ยืนยันหมายเลขโทรศัพท์</h2>
                    <p class="text-muted">กรุณากรอกรหัส OTP ที่ส่งไปยังหมายเลข <strong id="otp-phone-number" style="font-weight: 500; color: var(--primary-color);"></strong></p>

                    <div class="otp-container">
                        <input type="text" class="otp-input" maxlength="1" data-index="0" inputmode="numeric" pattern="[0-9]*" aria-label="OTP digit 1">
                        <input type="text" class="otp-input" maxlength="1" data-index="1" inputmode="numeric" pattern="[0-9]*" aria-label="OTP digit 2">
                        <input type="text" class="otp-input" maxlength="1" data-index="2" inputmode="numeric" pattern="[0-9]*" aria-label="OTP digit 3">
                        <input type="text" class="otp-input" maxlength="1" data-index="3" inputmode="numeric" pattern="[0-9]*" aria-label="OTP digit 4">
                        <input type="text" class="otp-input" maxlength="1" data-index="4" inputmode="numeric" pattern="[0-9]*" aria-label="OTP digit 5">
                        <input type="text" class="otp-input" maxlength="1" data-index="5" inputmode="numeric" pattern="[0-9]*" aria-label="OTP digit 6">
                    </div>

                    <div class="otp-reference">
                        <p>รหัส OTP สำหรับทดสอบ: <strong id="otp-reference-code">------</strong></p>
                        <small>(ในระบบจริง รหัสจะถูกส่งไปยังหมายเลขโทรศัพท์ของคุณ)</small>
                    </div>

                    <div class="resend-otp">
                        ไม่ได้รับรหัส OTP? <a href="#" id="resend-otp-link" class="disabled">ส่งรหัสใหม่</a> (<span id="countdown">60</span> วินาที)
                    </div>

                    <!-- Button Group: Primary first -->
                    <div class="btn-group">
                        <button type="button" class="btn next-step btn-3d" id="verify-otp-btn" data-next="5" disabled>ยืนยัน OTP <i class="fas fa-check"></i></button>
                        <button type="button" class="btn btn-outline prev-step" data-prev="3"><i class="fas fa-arrow-left"></i> ย้อนกลับ</button>
                    </div>
                </div>

                <!-- Step 5: ID Card Verification -->
                <div class="form-step" id="step-5">
                    <h2><i class="fas fa-id-card step-icon"></i> ยืนยันตัวตนด้วยบัตรประชาชน</h2>
                    <p class="text-muted">กรุณาถ่ายภาพบัตรประชาชนทั้งด้านหน้าและด้านหลัง</p>

                     <!-- Camera guide overlay (Common for both front and back) -->
                     <div class="camera-guide hidden" id="id-card-camera-guide">
                         <div class="id-card-frame"></div>
                         <div class="id-card-guide-text">วางบัตรประชาชนให้อยู่ในกรอบให้ชัดเจน</div>
                     </div>

                    <div class="id-card-guide">
                        <h4><i class="fas fa-info-circle"></i> วิธีการถ่ายภาพบัตรประชาชน</h4>
                        <ul>
                            <li>วางบัตรประชาชนบนพื้นผิวเรียบ ไม่สะท้อนแสง</li>
                            <li>ถ่ายในที่แสงสว่างเพียงพอ หลีกเลี่ยงเงาบนบัตร</li>
                            <li>ให้บัตรอยู่ในกรอบที่ปรากฏบนหน้าจอ</li>
                            <li>ตรวจสอบว่าข้อมูลบนบัตรอ่านได้ชัดเจน ไม่เบลอ</li>
                        </ul>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="input-label required-field" for="id-card-front">
                                    <i class="fas fa-id-card"></i>
                                    <span>บัตรประชาชนด้านหน้า</span>
                                </label>
                                <div class="upload-area" id="id-card-front-drop">
                                    <i class="fas fa-camera"></i>
                                    <p>กดเพื่อถ่ายภาพบัตรด้านหน้า</p>
                                    <small>ต้องเห็นเลขบัตร, ชื่อ-นามสกุล และรูปภาพชัดเจน</small>
                                </div>
                                <input type="file" id="id-card-front" accept="image/*" class="hidden" capture="environment">
                                <div class="preview-container hidden" id="front-preview-container">
                                    <div class="preview-card">
                                        <img src="" alt="บัตรประชาชนด้านหน้า" class="preview-image" id="front-preview-image">
                                        <div class="preview-info"> <p>บัตรประชาชนด้านหน้า</p> </div>
                                        <button type="button" class="remove-btn" id="remove-front" aria-label="ลบรูปบัตรด้านหน้า"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-col">
                            <div class="form-group">
                                <label class="input-label required-field" for="id-card-back">
                                    <i class="fas fa-id-card"></i>
                                    <span>บัตรประชาชนด้านหลัง</span>
                                </label>
                                <div class="upload-area" id="id-card-back-drop">
                                    <i class="fas fa-camera"></i>
                                    <p>กดเพื่อถ่ายภาพบัตรด้านหลัง</p>
                                    <small>ต้องเห็น Laser ID (ถ้ามี) ชัดเจน</small>
                                </div>
                                <input type="file" id="id-card-back" accept="image/*" class="hidden" capture="environment">
                                <div class="preview-container hidden" id="back-preview-container">
                                    <div class="preview-card">
                                        <img src="" alt="บัตรประชาชนด้านหลัง" class="preview-image" id="back-preview-image">
                                        <div class="preview-info"> <p>บัตรประชาชนด้านหลัง</p> </div>
                                        <button type="button" class="remove-btn" id="remove-back" aria-label="ลบรูปบัตรด้านหลัง"><i class="fas fa-times"></i></button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- OCR Result Section -->
                    <div class="ocr-result hidden" id="ocr-result">
                        <h4><i class="fas fa-check-circle"></i> ตรวจสอบข้อมูลจากบัตรประชาชน</h4>
                        <p class="text-muted" style="margin-bottom: 15px;">กรุณาตรวจสอบและแก้ไขข้อมูลหากไม่ถูกต้อง</p>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="id-number-kyc"><i class="fas fa-id-card"></i><span>เลขบัตรประชาชน</span></label>
                                    <input type="text" id="id-number-kyc" readonly >
                                </div>
                            </div>
                           <div class="form-col">
                               <div class="form-group">
                                   <label class="input-label" for="firstname-th"><i class="fas fa-user"></i><span>ชื่อ (ภาษาไทย)</span></label>
                                   <input type="text" id="firstname-th" placeholder="ชื่อตามบัตรประชาชน">
                               </div>
                           </div>
                        </div>
                         <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="lastname-th"><i class="fas fa-user"></i><span>นามสกุล (ภาษาไทย)</span></label>
                                    <input type="text" id="lastname-th" placeholder="นามสกุลตามบัตรประชาชน">
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="firstname-en"><i class="fas fa-user"></i><span>ชื่อ (ภาษาอังกฤษ)</span></label>
                                    <input type="text" id="firstname-en" placeholder="Firstname (optional)">
                                </div>
                            </div>
                         </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="lastname-en"><i class="fas fa-user"></i><span>นามสกุล (ภาษาอังกฤษ)</span></label>
                                    <input type="text" id="lastname-en" placeholder="Lastname (optional)">
                                </div>
                            </div>
                             <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="birthdate-kyc"><i class="fas fa-birthday-cake"></i><span>วันเกิด (พ.ศ.)</span></label>
                                    <input type="text" id="birthdate-kyc" readonly>
                                    <!-- Hidden fields to store separate values if needed -->
                                    <input type="hidden" id="birth-day-kyc">
                                    <input type="hidden" id="birth-month-kyc">
                                    <input type="hidden" id="birth-year-kyc">
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="address-kyc"><i class="fas fa-map-marker-alt"></i><span>ที่อยู่ตามบัตร</span></label>
                                    <textarea id="address-kyc" rows="3" placeholder="ที่อยู่ตามบัตรประชาชน"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="issue-date"><i class="fas fa-calendar-alt"></i><span>วันที่ออกบัตร (พ.ศ.)</span></label>
                                    <input type="text" id="issue-date" readonly>
                                </div>
                            </div>
                            <div class="form-col">
                                <div class="form-group">
                                    <label class="input-label" for="expiry-date"><i class="fas fa-calendar-times"></i><span>วันหมดอายุ (พ.ศ.)</span></label>
                                    <input type="text" id="expiry-date" readonly>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Button Group: Primary first -->
                    <div class="btn-group">
                        <button type="button" class="btn next-step btn-3d" id="verify-id-card-btn" data-next="6" disabled>ยืนยันข้อมูลบัตร <i class="fas fa-check"></i></button>
                        <button type="button" class="btn btn-outline prev-step" data-prev="4"><i class="fas fa-arrow-left"></i> ย้อนกลับ</button>
                    </div>
                </div>

                <!-- Step 6: Face Verification & Video Recording -->
                <div class="form-step" id="step-6">
                    <h2><i class="fas fa-user-check step-icon"></i> ยืนยันตัวตนด้วยใบหน้าและวิดีโอ</h2>
                    <p class="text-muted">กรุณาทำตามขั้นตอนด้านล่างเพื่อยืนยันตัวตนของคุณ</p>

                    <div class="face-verification">
                        <!-- Face Capture Section (Shown first) -->
                        <div id="face-capture-section">
                            <p class="text-muted" style="margin-bottom: 15px;">ส่วนที่ 1: บันทึกภาพใบหน้าตามคำแนะนำ</p>
                            <div class="webcam-container">
                                <video id="webcam-face" autoplay playsinline muted></video>
                                <div class="face-guide hidden" id="face-guide-overlay"></div>
                                <div class="face-action-text hidden" id="face-action-text"></div>
                                <div class="face-countdown-text hidden" id="face-countdown-text"></div>
                                <div class="webcam-overlay show-overlay"> <!-- Show initial overlay -->
                                    <i class="fas fa-user-circle" style="font-size: 30px; margin-bottom: 10px;"></i>
                                    <p>วางใบหน้าในกรอบและมองตรงไปที่กล้อง</p>
                                    <p style="font-size: 13px; margin-top: 10px;">ต้องเป็นภาพล่าสุด ห้ามใส่แว่นตาดำ หมวก หรือสิ่งปกปิดใบหน้า</p>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button type="button" class="btn btn-3d" id="start-face-capture" disabled>
                                    <i class="fas fa-camera"></i> เริ่มบันทึกภาพใบหน้า
                                </button>
                                <button type="button" class="btn btn-outline hidden" id="retake-face-capture" disabled>
                                    <i class="fas fa-redo"></i> บันทึกใบหน้าใหม่
                                </button>
                            </div>
                             <!-- Container for captured faces -->
                             <div class="captured-faces-container hidden" id="captured-faces-container"></div>
                        </div>

                        <!-- Video Recording Section (Initially Hidden) -->
                        <div class="video-recording-container hidden" id="video-recording-section">
                             <h4><i class="fas fa-video"></i> ส่วนที่ 2: บันทึกวิดีโอเพื่อยืนยัน</h4>
                            <p class="text-muted" style="margin-bottom: 10px;">กรุณาอ่านออกเสียงตามข้อความต่อไปนี้ให้ชัดเจน:</p>
                            <div class="webcam-container" style="margin-bottom: 10px;">
                                <video id="webcam-video" autoplay playsinline muted></video>
                                <div id="recording-instruction-container"> <!-- Kept but controlled visibility via JS -->
                                    <p id="recording-instruction">
                                        "ข้าพเจ้า [ชื่อ-นามสกุล] ขอยืนยันว่าข้อมูลทั้งหมดที่ให้ไว้เป็นความจริงและถูกต้องทุกประการ"
                                    </p>
                                </div>
                                 <div class="recording-indicator hidden" id="recording-indicator">
                                    <div class="pulse-dot"></div>
                                    <span>กำลังบันทึก...</span>
                                </div>
                            </div>
                            <div class="action-buttons">
                                <button type="button" class="btn btn-3d" id="start-recording" disabled>
                                    <i class="fas fa-microphone"></i> เริ่มบันทึกวิดีโอ
                                </button>
                                <button type="button" class="btn hidden" id="stop-recording" style="background: var(--danger-color);" disabled>
                                    <i class="fas fa-stop"></i> หยุดบันทึก
                                </button>
                            </div>
                            <!-- Video Preview -->
                            <div class="preview-container hidden" id="video-preview-container" style="margin-top: 20px;">
                                 <div class="preview-card">
                                      <video controls controlsList="nodownload noremoteplayback" disablePictureInPicture class="preview-image" id="video-preview"></video>
                                      <div class="preview-info">
                                          <p>วิดีโอการยืนยันของคุณ</p>
                                      </div>
                                      <button type="button" class="remove-btn" id="remove-video" aria-label="ลบวิดีโอ"><i class="fas fa-times"></i></button>
                                 </div>
                             </div>
                        </div>
                    </div> <!-- End face-verification -->

                    <!-- Button Group -->
                    <div class="btn-group">
                        <button type="button" class="btn btn-3d hidden" id="submit-kyc-btn" disabled>ส่งข้อมูลเพื่อตรวจสอบ <i class="fas fa-paper-plane"></i></button>
                        <button type="button" class="btn btn-outline prev-step" data-prev="5"><i class="fas fa-arrow-left"></i> ย้อนกลับ</button>
                    </div>
                </div>

                <!-- Success Step -->
                <div class="form-step" id="success-step">
                    <div class="success-message">
                        <div class="pulse" style="margin-bottom: 20px;">
                             <i class="fas fa-check-circle success-icon"></i>
                        </div>
                        <h2>ส่งข้อมูลสำเร็จ!</h2>
                        <p>ระบบได้รับข้อมูลการยืนยันตัวตนของคุณเรียบร้อยแล้ว</p>
                        <p>กรุณารอการตรวจสอบและอนุมัติจากเจ้าหน้าที่ ซึ่งอาจใช้เวลา 1-3 วันทำการ</p>
                        <p>คุณจะได้รับการแจ้งเตือนผ่าน LINE หรือ SMS เมื่อสถานะมีการเปลี่ยนแปลง</p>
                        <div class="status-pending" style="margin: 20px auto;">
                            <i class="fas fa-clock"></i> อยู่ระหว่างการตรวจสอบ
                        </div>
                        <button type="button" class="btn btn-3d" id="close-app-btn">
                            <i class="fas fa-times"></i> ปิดหน้าต่างนี้
                        </button>
                    </div>
                </div>
            </div> <!-- End card-body -->
        </div> <!-- End registration-card -->
    </div> <!-- End container -->

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // --- DOM Elements ---
            const nextButtons = document.querySelectorAll('.next-step');
            const prevButtons = document.querySelectorAll('.prev-step');
            const steps = document.querySelectorAll('.form-step');
            const cardBody = document.querySelector('.card-body'); // For animation handling
            const flashEffect = document.getElementById('flash-effect');
            // Removed header close button
            // const closeBtn = document.getElementById('close-btn');
            const closeAppBtn = document.getElementById('close-app-btn');

            // Step 1 Elements
            const pdpaCheckbox = document.getElementById('pdpa-agreement');
            const marketingCheckbox = document.getElementById('marketing-consent'); // Added marketing consent checkbox
            const acceptPdpaBtn = document.getElementById('accept-pdpa-btn');

            // Step 2 Elements
            const pinFields = document.querySelectorAll('.pin-input-field');
            const numericKeys = document.querySelectorAll('.numeric-key[data-value]');
            const backspaceKey = document.querySelector('.numeric-key.backspace');
            const confirmPinBtn = document.getElementById('confirm-pin-btn');

            // Step 3 Elements
            const phoneInput = document.getElementById('phone');
            const idInput = document.getElementById('id-number');
            const birthDaySelect = document.getElementById('birth-day');
            const birthMonthSelect = document.getElementById('birth-month');
            const birthYearSelect = document.getElementById('birth-year');
            const phoneValidIcon = document.getElementById('phone-valid-icon');
            const idValidIcon = document.getElementById('id-valid-icon');
            const phoneWarning = document.getElementById('phone-warning');
            const idWarning = document.getElementById('id-warning');
            const birthdateWarning = document.getElementById('birthdate-warning');
            const sendOtpBtn = document.getElementById('send-otp-btn');

            // Step 4 Elements
            const otpInputs = document.querySelectorAll('.otp-input');
            const otpPhoneNumber = document.getElementById('otp-phone-number');
            const otpReferenceCode = document.getElementById('otp-reference-code');
            const countdownElement = document.getElementById('countdown');
            const resendOtpLink = document.getElementById('resend-otp-link');
            const verifyOtpBtn = document.getElementById('verify-otp-btn');

            // Step 5 Elements
            const idCardFrontInput = document.getElementById('id-card-front');
            const idCardBackInput = document.getElementById('id-card-back');
            const idCardFrontDrop = document.getElementById('id-card-front-drop');
            const idCardBackDrop = document.getElementById('id-card-back-drop');
            const frontPreviewContainer = document.getElementById('front-preview-container');
            const backPreviewContainer = document.getElementById('back-preview-container');
            const frontPreviewImage = document.getElementById('front-preview-image');
            const backPreviewImage = document.getElementById('back-preview-image');
            const removeFrontBtn = document.getElementById('remove-front');
            const removeBackBtn = document.getElementById('remove-back');
            const ocrResultDiv = document.getElementById('ocr-result');
            const verifyIdCardBtn = document.getElementById('verify-id-card-btn');
            const idCardCameraGuide = document.getElementById('id-card-camera-guide');
            const ocrFieldsIds = ['id-number-kyc', 'firstname-th', 'lastname-th', 'firstname-en', 'lastname-en', 'birthdate-kyc', 'address-kyc', 'issue-date', 'expiry-date'];

            // Step 6 Elements
            const videoElementFace = document.getElementById('webcam-face');
            const videoElementVideo = document.getElementById('webcam-video');
            const faceGuideOverlay = document.getElementById('face-guide-overlay');
            const faceActionText = document.getElementById('face-action-text');
            const faceCountdownText = document.getElementById('face-countdown-text');
            const startFaceCaptureBtn = document.getElementById('start-face-capture');
            const retakeFaceCaptureBtn = document.getElementById('retake-face-capture');
            const capturedFacesContainer = document.getElementById('captured-faces-container');
            const faceCaptureSection = document.getElementById('face-capture-section');
            const videoRecordingSection = document.getElementById('video-recording-section');
            const startRecordingBtn = document.getElementById('start-recording');
            const stopRecordingBtn = document.getElementById('stop-recording');
            const recordingIndicator = document.getElementById('recording-indicator');
            const recordingInstructionContainer = document.getElementById('recording-instruction-container');
            const recordingInstruction = document.getElementById('recording-instruction');
            const videoPreviewContainer = document.getElementById('video-preview-container');
            const videoPreview = document.getElementById('video-preview');
            const removeVideoBtn = document.getElementById('remove-video');
            const submitKycBtn = document.getElementById('submit-kyc-btn');

            // --- State Variables ---
            let currentStep = 1;
            const totalLogicalSteps = 6;
            let otpSent = false;
            let otpVerified = false;
            let otpCode = '';
            let countdownInterval;
            let stream = null;
            let faceCaptureTimeout;
            let currentFaceActionIndex = 0;
            let capturedFaces = [];
            let mediaRecorder;
            let recordedChunks = [];
            let pinCode = '';
            let currentPinIndex = 0;
            const MIN_AGE = 18;
            const MAX_AGE = 65;
            let isTransitioning = false; // Flag to prevent double clicks during animation

            const faceActions = [
                { instruction: "กรุณามองตรง", duration: 3 },
                { instruction: "กรุณายิ้ม", duration: 4 },
                { instruction: "กรุณาอ้าปาก", duration: 4 },
                { instruction: "กรุณาหันหน้าไปทางซ้ายช้าๆ", duration: 5 },
                { instruction: "กรุณาหันหน้าไปทางขวาช้าๆ", duration: 5 }
            ];

            // Mock Data
            const registeredUsers = [
                { phone: "0812345678", idNumber: "1111111111111" },
                { phone: "0898765432", idNumber: "2222222222222" }
            ];

            // --- Initialization ---
            initializeDateSelectors();
            setupPinInput();
            setupOtpInput();
            updateStep3ButtonState(); // Initial check for step 3 button

            // --- Event Listeners ---
            nextButtons.forEach(button => button.addEventListener('click', handleNextStep));
            prevButtons.forEach(button => button.addEventListener('click', handlePrevStep));
            // Removed header close button listener
            // closeBtn.addEventListener('click', confirmClose);
            closeAppBtn.addEventListener('click', closeWindow);

            // Step 1
            pdpaCheckbox.addEventListener('change', () => {
                acceptPdpaBtn.disabled = !pdpaCheckbox.checked;
            });
            // Marketing checkbox doesn't affect the main flow button

            // Step 2
            // (Handled by next button click -> handleNextStep -> validateStep2)

            // Step 3
            phoneInput?.addEventListener('input', () => { validatePhoneNumberFormat(); updateStep3ButtonState(); });
            idInput?.addEventListener('input', () => { validateIdNumberFormat(); updateStep3ButtonState(); });
            birthDaySelect?.addEventListener('change', () => { validateBirthdate(); updateStep3ButtonState(); });
            birthMonthSelect?.addEventListener('change', () => { validateBirthdate(); updateStep3ButtonState(); });
            birthYearSelect?.addEventListener('change', () => { validateBirthdate(); updateStep3ButtonState(); });
            // sendOtpBtn is handled by handleNextStep

            // Step 4
            resendOtpLink?.addEventListener('click', handleResendOtp);
            // verifyOtpBtn is handled by handleNextStep (or auto-verify)

            // Step 5
            setupFileUpload('id-card-front', 'id-card-front-drop', 'front-preview-container', 'front-preview-image', 'remove-front');
            setupFileUpload('id-card-back', 'id-card-back-drop', 'back-preview-container', 'back-preview-image', 'remove-back');
            ocrFieldsIds.forEach(id => {
                const input = document.getElementById(id);
                if (input && (input.tagName === 'INPUT' || input.tagName === 'TEXTAREA')) {
                    input.addEventListener('input', () => {
                        input.style.borderColor = '#ccc'; // Reset border on edit
                        validateStep5(false); // Re-validate silently to update button state
                    });
                }
            });
            // verifyIdCardBtn is handled by handleNextStep

            // Step 6
            startFaceCaptureBtn?.addEventListener('click', startFaceCaptureProcess);
            retakeFaceCaptureBtn?.addEventListener('click', retakeFaceCapture);
            startRecordingBtn?.addEventListener('click', showRecordingInstructionAlert); // Changed to show alert first
            stopRecordingBtn?.addEventListener('click', stopRecording);
            removeVideoBtn?.addEventListener('click', removeVideo);
            submitKycBtn?.addEventListener('click', handleSubmitKyc);

            // Cleanup
            window.addEventListener('beforeunload', cleanupResources);

            // --- Core Navigation ---

             function handleNextStep(event) {
                if (isTransitioning) return; // Prevent action during animation
                const button = event.target.closest('button');
                 if (!button || button.disabled) return; // Ignore clicks on disabled buttons

                const nextLogicalStep = parseInt(button.getAttribute('data-next'));
                let canProceed = false;

                switch (currentStep) {
                    case 1: canProceed = validateStep1(); break;
                    case 2: canProceed = validateStep2(); break;
                    case 3: canProceed = validateStep3(true); // Check duplicates when trying to send OTP
                            if (canProceed) { handleSendOtp(nextLogicalStep); return; } // Send OTP and go
                            break;
                    case 4: canProceed = validateStep4(true); // Validate OTP on button click
                            if (canProceed) { handleVerifyOtpSuccess(nextLogicalStep); return; } // Go to next step after delay
                            break;
                    case 5: canProceed = validateStep5(true); // Validate ID card/OCR on button click
                            if (canProceed) { handleVerifyIdCard(nextLogicalStep); return; } // Process data and go
                            break;
                    case 6: console.warn("Next button clicked on step 6 - shouldn't happen"); return; // Should use Submit button
                    default: canProceed = true;
                 }

                 if (canProceed) {
                     goToStep(nextLogicalStep, 'next');
                 }
            }

            function handlePrevStep(event) {
                 if (isTransitioning) return;
                 const button = event.target.closest('button');
                 if (!button || button.disabled) return;

                 const prevLogicalStep = parseInt(button.getAttribute('data-prev'));
                if (prevLogicalStep >= 1) {
                    goToStep(prevLogicalStep, 'prev');
                }
            }

            function goToStep(stepNumber, direction = 'next') {
                 if (stepNumber < 1 || stepNumber > totalLogicalSteps + 1 || isTransitioning) return;

                 isTransitioning = true; // Start transition lock
                 const currentStepElement = document.getElementById(`step-${currentStep}`) || document.getElementById('success-step');
                 const targetStepId = stepNumber <= totalLogicalSteps ? `step-${stepNumber}` : 'success-step';
                 const targetStepElement = document.getElementById(targetStepId);

                 if (!currentStepElement || !targetStepElement) {
                     console.error("Error finding step elements for transition.");
                     isTransitioning = false;
                     return;
                 }

                 // --- Animation Logic ---
                 const outAnimation = direction === 'next' ? 'slide-out-left' : 'slide-out-right';
                 const inAnimation = direction === 'next' ? 'slide-in-right' : 'slide-in-left';

                 // 1. Add 'out' animation class to current step
                 currentStepElement.classList.add(outAnimation);

                 // 2. After a short delay (less than animation duration), hide current, show target, add 'in' animation
                 setTimeout(() => {
                     currentStepElement.classList.remove('active');
                     targetStepElement.classList.remove('slide-out-left', 'slide-out-right', 'slide-in-left', 'slide-in-right'); // Clean up previous animations
                     targetStepElement.classList.add('active', inAnimation);

                     // 3. Update currentStep tracker
                     currentStep = stepNumber;

                     // --- Step Specific Entry Logic ---
                      if (currentStep === 3) {
                         phoneInput?.focus(); // Focus phone on entering step 3
                         updateStep3ButtonState(); // Ensure button state is correct on entry
                      }
                     if (currentStep === 4) {
                         otpInputs[0]?.focus(); // Focus first OTP input
                         updateStep4ButtonState(); // Check button state
                     }
                     if (currentStep === 5) {
                         resetOcrFields(); // Reset OCR fields on entry
                         document.getElementById('ocr-result').classList.add('hidden');
                         updateStep5ButtonState(); // Check button state
                     }
                     if (currentStep === 6) {
                         initWebcam(); // Initialize webcam
                         resetStep6UI(); // Reset UI elements
                     }
                     // Scroll to top
                     cardBody.scrollTo({ top: 0, behavior: 'smooth' });

                 }, 150); // Delay slightly less than animation duration

                  // 4. Remove animation classes after animation completes + small buffer
                  setTimeout(() => {
                       currentStepElement.classList.remove(outAnimation);
                       targetStepElement.classList.remove(inAnimation);
                       isTransitioning = false; // Release transition lock
                   }, 500); // Should match animation duration + buffer
            }

            // Removed confirmClose function as the button is removed from header

            function closeWindow() {
                cleanupResources();
                // In a real LIFF app, use liff.closeWindow();
                // For demo purposes:
                console.log("Attempting to close window...");
                try {
                    // Try standard close methods
                     window.close();
                    // If in an iframe (like some development environments)
                    if (window.parent && window.parent !== window) {
                         // Send a message to the parent to close, or try other methods
                    }
                    // If those fail, maybe redirect to a blank page or a confirmation page
                    // window.location.href = 'about:blank';
                     alert('กรุณาปิดหน้าต่างนี้ด้วยตนเอง'); // Fallback alert
                } catch (e) {
                     console.error("Error closing window:", e);
                     alert('กรุณาปิดหน้าต่างนี้ด้วยตนเอง'); // Fallback alert
                }
            }

            function cleanupResources() {
                stopWebcamAndRecording();
                if (countdownInterval) clearInterval(countdownInterval);
                if (faceCaptureTimeout) clearTimeout(faceCaptureTimeout);
                if(videoPreview.src) URL.revokeObjectURL(videoPreview.src);
            }

            // --- Step Specific Logic ---

            // Step 1: PDPA
            function validateStep1() {
                if (!pdpaCheckbox.checked) {
                    showError('จำเป็นต้องยอมรับ PDPA', 'กรุณายอมรับนโยบายความเป็นส่วนตัว (PDPA) ก่อนดำเนินการต่อ');
                    shakeElement(pdpaCheckbox.closest('.pdpa-agreement'));
                    return false;
                }
                return true;
            }

            // Step 2: PIN
             function setupPinInput() {
                numericKeys.forEach(key => {
                    key.addEventListener('click', () => handlePinKeyPress(key.getAttribute('data-value')));
                });
                backspaceKey.addEventListener('click', () => handlePinKeyPress(null, true));
                updatePinDisplay(); // Initial display setup
            }

            function handlePinKeyPress(value, isBackspace = false) {
                if (isBackspace) {
                    if (currentPinIndex > 0) {
                        currentPinIndex--;
                        pinCode = pinCode.slice(0, -1);
                    }
                } else if (value !== null && currentPinIndex < pinFields.length) {
                    pinCode += value;
                    currentPinIndex++;
                }
                updatePinDisplay();
                updateStep2ButtonState(); // Update button state
            }

            function updatePinDisplay() {
                pinFields.forEach((field, index) => {
                    const dot = field.querySelector('.pin-input-dot');
                    const isFilled = index < currentPinIndex;
                    const isActive = index === currentPinIndex && currentPinIndex < pinFields.length;

                    field.classList.toggle('filled', isFilled);
                    field.classList.toggle('active', isActive);

                    if (dot) {
                         // Manage dot animation/visibility
                         if(isFilled) {
                            dot.style.opacity = '1';
                            dot.style.transform = 'scale(1)';
                            // dot.style.animation = 'fillDot 0.2s ease-out forwards'; // Apply animation directly if needed
                         } else {
                            dot.style.opacity = '0';
                            dot.style.transform = 'scale(0.5)';
                         }
                    }
                });
            }

            function updateStep2ButtonState() {
                 confirmPinBtn.disabled = pinCode.length !== 6;
            }

            function validateStep2() {
                if (pinCode.length !== 6) {
                    showError('PIN ไม่ครบ', 'กรุณากรอก PIN Code 6 หลักให้ครบถ้วน');
                    shakeElement(document.querySelector('.pin-input-container'));
                    return false;
                }
                console.log("PIN Set (masked): ******"); // Log for confirmation, mask actual PIN
                return true;
            }

            // Step 3: Basic Info Validation & OTP Send
            function initializeDateSelectors() {
                birthDaySelect.innerHTML = '<option value="" selected disabled>วัน</option>';
                birthYearSelect.innerHTML = '<option value="" selected disabled>ปี</option>';
                const currentYearBE = new Date().getFullYear() + 543;
                for (let i = 1; i <= 31; i++) birthDaySelect.appendChild(new Option(i, i));
                for (let i = currentYearBE - MIN_AGE; i >= currentYearBE - MAX_AGE; i--) birthYearSelect.appendChild(new Option(i, i));
             }

             function validatePhoneNumberFormat() {
                 const phone = phoneInput.value;
                 const isValid = /^[0][689]\d{8}$/.test(phone);
                 phoneValidIcon?.classList.toggle('hidden', !isValid);
                 phoneInput.style.borderColor = isValid ? 'var(--success-color)' : '#ccc';
                 if (phone.length > 0 && !isValid) phoneInput.style.borderColor = 'var(--danger-color)'; // Error if typed but invalid
                 phoneWarning.style.display = 'none'; // Hide duplicate warning during format check
                 return isValid;
             }

             function validateIdNumberFormat() {
                 const idNumber = idInput.value;
                 idWarning.style.display = 'none'; // Hide warnings initially
                 idWarning.innerHTML = '<i class="fas fa-exclamation-circle"></i> รูปแบบเลขบัตรประชาชนไม่ถูกต้อง';
                 let isValid = false;
                 if (idNumber.length === 13 && /^[0-9]+$/.test(idNumber)) {
                     let sum = 0;
                     for(let i=0; i < 12; i++) sum += parseFloat(idNumber.charAt(i))*(13-i);
                     const checkDigit = (11 - (sum % 11)) % 10;
                     isValid = (checkDigit === parseFloat(idNumber.charAt(12)));
                 }
                 idValidIcon?.classList.toggle('hidden', !isValid);
                 idInput.style.borderColor = isValid ? 'var(--success-color)' : '#ccc';
                 if (idNumber.length > 0 && idNumber.length < 13) {
                    idInput.style.borderColor = 'var(--danger-color)';
                 } else if (idNumber.length === 13 && !isValid) {
                     idInput.style.borderColor = 'var(--danger-color)';
                     idWarning.style.display = 'flex'; // Show format warning only if length is 13 but invalid checksum
                 }
                 return isValid;
             }

            function validateBirthdate() {
                const day = birthDaySelect.value;
                const month = birthMonthSelect.value;
                const year = birthYearSelect.value;
                birthdateWarning.style.display = 'none'; // Hide warning initially
                if (!day || !month || !year) return false;

                const currentYearBE = new Date().getFullYear() + 543;
                const age = currentYearBE - parseInt(year);
                let isValidAge = age >= MIN_AGE && age <= MAX_AGE;
                let isValidDate = true;

                // Check if day is valid for the month/year
                const daysInMonth = new Date(year - 543, month, 0).getDate();
                if (parseInt(day) > daysInMonth) {
                    isValidDate = false;
                    birthdateWarning.innerHTML = '<i class="fas fa-exclamation-circle"></i> วันที่ไม่ถูกต้องสำหรับเดือนนี้';
                    birthdateWarning.style.display = 'flex';
                } else if (!isValidAge) {
                     birthdateWarning.innerHTML = '<i class="fas fa-exclamation-circle"></i> อายุต้องอยู่ระหว่าง 18-65 ปี';
                     birthdateWarning.style.display = 'flex';
                }

                return isValidAge && isValidDate;
            }

            function updateStep3ButtonState() {
                 const isPhoneValid = validatePhoneNumberFormat();
                 const isIdValid = validateIdNumberFormat();
                 const isDobValid = validateBirthdate();
                 // Enable button only if all formats are correct (duplicate check happens on button click)
                 sendOtpBtn.disabled = !(isPhoneValid && isIdValid && isDobValid);
            }

             function checkDuplicateData(phone, idNumber) {
                 // This function now focuses only on checking duplicates and showing related warnings
                 let phoneDuplicate = registeredUsers.some(user => user.phone === phone);
                 let idDuplicate = registeredUsers.some(user => user.idNumber === idNumber);

                 if (phoneDuplicate) {
                     phoneWarning.innerHTML = '<i class="fas fa-exclamation-circle"></i> หมายเลขโทรศัพท์นี้ถูกใช้งานแล้ว';
                     phoneWarning.style.display = 'flex';
                     phoneInput.style.borderColor = 'var(--danger-color)'; // Add red border for duplicate
                 } else {
                     phoneWarning.style.display = 'none'; // Hide if not duplicate
                     if(validatePhoneNumberFormat()) phoneInput.style.borderColor = 'var(--success-color)'; // Set back to green if format is valid
                 }

                 if (idDuplicate) {
                     idWarning.innerHTML = '<i class="fas fa-exclamation-circle"></i> เลขบัตรประชาชนนี้ถูกใช้งานแล้ว';
                     idWarning.style.display = 'flex';
                     idInput.style.borderColor = 'var(--danger-color)'; // Add red border for duplicate
                 } else {
                     // Only hide duplicate warning, keep format warning if it was shown
                     if (!idWarning.innerHTML.includes('รูปแบบเลขบัตรประชาชนไม่ถูกต้อง')) {
                          idWarning.style.display = 'none';
                     }
                      if(validateIdNumberFormat()) idInput.style.borderColor = 'var(--success-color)'; // Set back to green if format is valid
                 }

                 return phoneDuplicate || idDuplicate;
             }

             function validateStep3(checkDuplicates = true) {
                 let isFormatValid = true;
                 let firstInvalidElement = null;

                 if (!validatePhoneNumberFormat()) { isFormatValid = false; if (!firstInvalidElement) firstInvalidElement = phoneInput; }
                 if (!validateIdNumberFormat()) { isFormatValid = false; if (!firstInvalidElement) firstInvalidElement = idInput; }
                 if (!validateBirthdate()) { isFormatValid = false; if (!firstInvalidElement) firstInvalidElement = birthDaySelect; } // Point to first dropdown

                 let hasDuplicates = false;
                 if (isFormatValid && checkDuplicates) {
                     hasDuplicates = checkDuplicateData(phoneInput.value, idInput.value);
                     if (hasDuplicates && !firstInvalidElement) {
                         if (phoneWarning.style.display === 'flex') firstInvalidElement = phoneInput;
                         else if (idWarning.style.display === 'flex') firstInvalidElement = idInput;
                     }
                 }

                 const isValid = isFormatValid && !hasDuplicates;

                 if (!isValid && checkDuplicates) { // Only show general error when submitting
                    let errorTitle = 'ข้อมูลไม่ถูกต้อง';
                    let errorText = 'กรุณาตรวจสอบข้อมูลที่กรอกและแก้ไขให้ถูกต้อง';
                     if (hasDuplicates) { errorText = 'ข้อมูลหมายเลขโทรศัพท์ หรือ เลขบัตรประชาชน ซ้ำกับที่มีอยู่ในระบบ'; }
                     else if (!isFormatValid) { errorText = 'รูปแบบข้อมูลบางอย่างไม่ถูกต้อง กรุณาตรวจสอบ';}

                     showError(errorTitle, errorText);
                     if (firstInvalidElement) {
                        firstInvalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                         setTimeout(() => {
                             firstInvalidElement.focus();
                             shakeElement(firstInvalidElement.closest('.form-group') || firstInvalidElement);
                         }, 300);
                     }
                 }
                 return isValid;
             }

             function handleSendOtp(nextStep) {
                 otpCode = Math.floor(100000 + Math.random() * 900000).toString();
                 console.log('Generated OTP (Demo):', otpCode);
                 otpReferenceCode.textContent = otpCode;
                 otpSent = true;
                 otpPhoneNumber.textContent = phoneInput.value;
                 startOtpCountdown();
                 clearOtpInputs();
                 goToStep(nextStep, 'next');
             }

            // Step 4: OTP Verification
            function setupOtpInput() {
                otpInputs.forEach((input, index) => {
                    input.addEventListener('input', (e) => {
                        let value = e.target.value.replace(/\D/g, '');
                        e.target.value = value;
                        input.classList.remove('error'); // Remove error class on input

                        if (value && index < otpInputs.length - 1) {
                            otpInputs[index + 1].focus();
                        }
                        input.classList.toggle('filled', value.length > 0);
                        updateStep4ButtonState(); // Update button state on input

                        if (value && index === otpInputs.length - 1) {
                             setTimeout(() => handleVerifyOtp(false), 100); // Auto verify attempt
                         }
                    });
                    input.addEventListener('keydown', (e) => {
                        input.classList.remove('error'); // Remove error class on keydown
                        if (e.key === 'Backspace') {
                            if (!e.target.value && index > 0) {
                                otpInputs[index - 1].focus();
                                otpInputs[index - 1].value = '';
                                otpInputs[index - 1].classList.remove('filled');
                            } else {
                                e.target.value = '';
                                e.target.classList.remove('filled');
                            }
                            updateStep4ButtonState(); // Update button state
                         } else if (e.key === 'ArrowLeft' && index > 0) { e.preventDefault(); otpInputs[index - 1].focus(); }
                         else if (e.key === 'ArrowRight' && index < otpInputs.length - 1) { e.preventDefault(); otpInputs[index + 1].focus(); }
                         else if (e.key.length === 1 && /\D/.test(e.key) && !e.ctrlKey && !e.metaKey) { e.preventDefault(); } // Allow digits only
                    });
                     input.addEventListener('paste', handleOtpPaste);
                     input.addEventListener('focus', () => input.select());
                });
            }

            function handleOtpPaste(e) {
                 e.preventDefault();
                 const pasteData = (e.clipboardData || window.clipboardData).getData('text').replace(/\D/g, '');
                 const currentFocusIndex = Array.from(otpInputs).findIndex(el => el === document.activeElement);
                 let pasteIndex = 0;
                 otpInputs.forEach(input => input.classList.remove('error')); // Clear errors on paste

                 for (let i = currentFocusIndex; i < otpInputs.length && pasteIndex < pasteData.length; i++) {
                    otpInputs[i].value = pasteData[pasteIndex];
                    otpInputs[i].classList.add('filled');
                    pasteIndex++;
                    if (i < otpInputs.length - 1) {
                        otpInputs[i+1].focus();
                    }
                 }
                 updateStep4ButtonState(); // Update button after paste
                 if (currentFocusIndex + pasteData.length >= otpInputs.length) {
                     setTimeout(() => handleVerifyOtp(false), 100);
                 }
            }

            function clearOtpInputs() {
                otpInputs.forEach(input => { input.value = ''; input.classList.remove('filled', 'error'); });
                if (otpInputs.length > 0) otpInputs[0].focus();
                updateStep4ButtonState(); // Update button when cleared
            }

            function startOtpCountdown() {
                let seconds = 60;
                resendOtpLink.classList.add('disabled');
                countdownElement.textContent = seconds;
                clearInterval(countdownInterval); // Clear existing interval first
                countdownInterval = setInterval(() => {
                    seconds--;
                    countdownElement.textContent = seconds;
                    if (seconds <= 0) {
                        clearInterval(countdownInterval);
                        resendOtpLink.classList.remove('disabled');
                        countdownElement.textContent = '0';
                    }
                }, 1000);
            }

            function handleResendOtp(e) {
                 e.preventDefault();
                 if (e.target.classList.contains('disabled')) return;
                 otpCode = Math.floor(100000 + Math.random() * 900000).toString();
                 console.log('Resent OTP (Demo):', otpCode);
                 otpReferenceCode.textContent = otpCode;
                 startOtpCountdown();
                 clearOtpInputs();
                 showSuccess('ส่ง OTP ใหม่แล้ว', 'กรุณากรอกรหัส OTP ที่ได้รับ');
            }

             function updateStep4ButtonState() {
                let enteredOtp = '';
                otpInputs.forEach(input => enteredOtp += input.value);
                verifyOtpBtn.disabled = enteredOtp.length !== 6;
             }

            function handleVerifyOtp(showErrorOnFail = true) {
                 if (validateStep4(showErrorOnFail)) {
                    handleVerifyOtpSuccess(currentStep + 1);
                 }
            }
            // Separate success handling to be called by button or auto-verify
            function handleVerifyOtpSuccess(nextStep) {
                 otpVerified = true;
                 clearInterval(countdownInterval);
                 resendOtpLink.classList.add('disabled');
                 verifyOtpBtn.disabled = true;
                 verifyOtpBtn.innerHTML = '<i class="fas fa-check"></i> ยืนยันสำเร็จ';
                 otpInputs.forEach(input => input.classList.add('success')); // Optional success styling
                 setTimeout(() => { goToStep(nextStep, 'next'); }, 800);
            }

            function validateStep4(showErrorOnFail = true) {
                let enteredOtp = '';
                let allFilled = true;
                otpInputs.forEach(input => {
                    enteredOtp += input.value;
                    if (!input.value) allFilled = false;
                    input.classList.remove('error'); // Clear previous errors
                });

                if (!allFilled || enteredOtp.length !== 6) {
                    if (showErrorOnFail) {
                        showError('OTP ไม่ครบ', 'กรุณากรอกรหัส OTP 6 หลักให้ครบถ้วน');
                        const firstEmpty = Array.from(otpInputs).find(input => !input.value);
                        shakeElement(firstEmpty || document.querySelector('.otp-container'));
                    }
                    return false;
                }

                if (enteredOtp !== otpCode) {
                    if (showErrorOnFail) {
                        showError('OTP ไม่ถูกต้อง', 'รหัส OTP ที่คุณกรอกไม่ถูกต้อง กรุณาลองใหม่');
                        otpInputs.forEach(input => input.classList.add('error')); // Add error class for styling
                        shakeElement(document.querySelector('.otp-container'));
                    }
                    return false;
                }
                 return true;
            }

            // Step 5: ID Card Upload & OCR
             function setupFileUpload(inputId, dropZoneId, previewContainerId, previewImageId, removeButtonId) {
                 const fileInput = document.getElementById(inputId);
                 const dropZone = document.getElementById(dropZoneId);
                 const previewContainer = document.getElementById(previewContainerId);
                 const previewImage = document.getElementById(previewImageId);
                 const removeButton = document.getElementById(removeButtonId);
                 const otherInputId = inputId === 'id-card-front' ? 'id-card-back' : 'id-card-front';
                 const otherFileInput = document.getElementById(otherInputId);

                 dropZone.addEventListener('click', () => {
                    idCardCameraGuide?.classList.add('visible');
                    setTimeout(() => fileInput.click(), 50);
                 });

                 fileInput.addEventListener('change', function() {
                     idCardCameraGuide?.classList.remove('visible');
                     if (this.files && this.files[0]) {
                         handleFileDisplay(this.files[0], previewImage, previewContainer, dropZone);
                         if (otherFileInput.files.length > 0 && this.files.length > 0) { simulateOCRScan(); }
                         else { updateStep5ButtonState(); } // Update button if only one file is present
                     } else {
                          idCardCameraGuide?.classList.remove('visible');
                          resetPreview(previewImage, previewContainer, dropZone);
                          updateStep5ButtonState(); // Update button state
                     }
                 });
                 removeButton.addEventListener('click', (e) => {
                     e.stopPropagation();
                     fileInput.value = '';
                     resetPreview(previewImage, previewContainer, dropZone);
                     ocrResultDiv.classList.add('hidden');
                     resetOcrFields();
                     updateStep5ButtonState(); // Update button state
                 });
                 ['dragenter', 'dragover'].forEach(eventName => {
                     dropZone.addEventListener(eventName, (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.add('dragover'); });
                 });
                 ['dragleave', 'drop'].forEach(eventName => {
                     dropZone.addEventListener(eventName, (e) => {
                         e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('dragover');
                         if (eventName === 'drop') {
                             const files = e.dataTransfer.files;
                             if (files.length && files[0].type.startsWith('image/')) {
                                fileInput.files = files;
                                fileInput.dispatchEvent(new Event('change'));
                              }
                             else if (files.length) { showError('ไฟล์ไม่ถูกต้อง', 'กรุณาเลือกไฟล์ภาพเท่านั้น'); }
                         }
                     }, false);
                 });
             }

             function resetPreview(imgElement, containerElement, dropZoneElement) {
                 imgElement.src = '';
                 containerElement.classList.add('hidden');
                 dropZoneElement.classList.remove('hidden');
                 dropZoneElement.style.borderColor = '#bdbdbd';
             }

            function handleFileDisplay(file, imgElement, containerElement, dropZoneElement) {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imgElement.src = e.target.result;
                        containerElement.classList.remove('hidden');
                        dropZoneElement.classList.add('hidden');
                        dropZoneElement.style.borderColor = '#bdbdbd';
                    }
                    reader.readAsDataURL(file);
                } else {
                    showError('ไฟล์ไม่ถูกต้อง', 'กรุณาเลือกไฟล์ภาพ (JPG, PNG, etc.)');
                    dropZoneElement.style.borderColor = 'var(--danger-color)';
                    resetPreview(imgElement, containerElement, dropZoneElement); // Reset if invalid file
                    updateStep5ButtonState(); // Update button
                }
            }

            function resetOcrFields() {
                ocrFieldsIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.value = '';
                        if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                            element.style.borderColor = '#ccc'; // Reset border
                            element.readOnly = (id === 'id-number-kyc' || id === 'birthdate-kyc' || id === 'issue-date' || id === 'expiry-date'); // Reset readonly state
                        }
                    }
                 });
                 // Reset hidden DOB fields
                 document.getElementById('birth-day-kyc').value = '';
                 document.getElementById('birth-month-kyc').value = '';
                 document.getElementById('birth-year-kyc').value = '';
                 ocrResultDiv.classList.add('hidden'); // Hide OCR section
                 updateStep5ButtonState(); // Update button state
            }

            function simulateOCRScan() {
                 const frontFile = idCardFrontInput.files;
                 const backFile = idCardBackInput.files;
                 if (!frontFile || frontFile.length === 0 || !backFile || backFile.length === 0) return;

                 resetOcrFields(); // Clear previous results
                 Swal.fire({ title: 'กำลังสแกนข้อมูล...', text: 'กรุณารอสักครู่ ระบบกำลังอ่านข้อมูลจากบัตร', allowOutsideClick: false, showConfirmButton: false, didOpen: () => { Swal.showLoading(); } });

                 setTimeout(() => {
                     Swal.close();
                     const idFromStep3 = idInput.value;
                     const dayFromStep3 = birthDaySelect.value;
                     const monthFromStep3 = birthMonthSelect.value;
                     const yearFromStep3 = birthYearSelect.value;
                     const isOcrSuccess = Math.random() < 0.95; // 95% success

                     if (isOcrSuccess) {
                         // Populate fields
                         document.getElementById('id-number-kyc').value = idFromStep3 || '1987654321098';
                         document.getElementById('firstname-th').value = 'ทดสอบ';
                         document.getElementById('lastname-th').value = 'ระบบ';
                         document.getElementById('firstname-en').value = 'TEST';
                         document.getElementById('lastname-en').value = 'SYSTEM';
                         if (dayFromStep3 && monthFromStep3 && yearFromStep3) {
                             const months = ["ม.ค.", "ก.พ.", "มี.ค.", "เม.ย.", "พ.ค.", "มิ.ย.", "ก.ค.", "ส.ค.", "ก.ย.", "ต.ค.", "พ.ย.", "ธ.ค."];
                             document.getElementById('birthdate-kyc').value = `${dayFromStep3} ${months[parseInt(monthFromStep3)-1] || '?'} ${yearFromStep3}`;
                             document.getElementById('birth-day-kyc').value = dayFromStep3; document.getElementById('birth-month-kyc').value = monthFromStep3; document.getElementById('birth-year-kyc').value = yearFromStep3;
                         } else {
                             document.getElementById('birthdate-kyc').value = '1 ม.ค. 2540';
                             document.getElementById('birth-day-kyc').value = '1'; document.getElementById('birth-month-kyc').value = '1'; document.getElementById('birth-year-kyc').value = '2540';
                         }
                         document.getElementById('address-kyc').value = '123/45 หมู่ 6 ถนนสุขุมวิท แขวงพระโขนง เขตคลองเตย กรุงเทพมหานคร 10110';
                         document.getElementById('issue-date').value = '10 ม.ค. 2563'; document.getElementById('expiry-date').value = '9 ม.ค. 2573';
                         ocrResultDiv.classList.remove('hidden');
                         ocrResultDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
                         showSuccess('สแกนข้อมูลสำเร็จ', 'กรุณาตรวจสอบความถูกต้องของข้อมูล');
                         // Make editable fields non-readonly (except the ones that should always be readonly)
                         ['firstname-th', 'lastname-th', 'firstname-en', 'lastname-en', 'address-kyc'].forEach(id => {
                             const el = document.getElementById(id); if(el) el.readOnly = false;
                         });
                     } else {
                         ocrResultDiv.classList.add('hidden');
                         showError('สแกนข้อมูลไม่สำเร็จ', 'ไม่สามารถอ่านข้อมูลจากบัตรได้ กรุณาถ่ายภาพใหม่อีกครั้งให้ชัดเจน');
                     }
                     updateStep5ButtonState(); // Update button state after OCR attempt
                 }, 2000);
             }

            function handleVerifyIdCard(nextStep) {
                 const firstName = document.getElementById('firstname-th').value.trim();
                 const lastName = document.getElementById('lastname-th').value.trim();
                 const nameText = (firstName && lastName) ? `${firstName} ${lastName}` : 'ข้าพเจ้า';
                 recordingInstruction.textContent = `"${nameText} ขอยืนยันว่าข้อมูลทั้งหมดที่ให้ไว้เป็นความจริงและถูกต้องทุกประการ"`;
                 // Check instruction container visibility before making it visible
                 if (recordingInstructionContainer) {
                    recordingInstructionContainer.classList.remove('visible'); // Ensure it starts hidden
                 }
                goToStep(nextStep, 'next');
            }

            function updateStep5ButtonState() {
                 verifyIdCardBtn.disabled = !validateStep5(false); // Validate silently
            }

            function validateStep5(showErrorOnFail = true) {
                 let isValid = true;
                 let firstInvalidElement = null;
                 const frontFiles = idCardFrontInput.files;
                 const backFiles = idCardBackInput.files;

                 // 1. Check images uploaded
                 if (!frontFiles || frontFiles.length === 0) {
                    isValid = false; if (showErrorOnFail && !firstInvalidElement) { firstInvalidElement = idCardFrontDrop; showError('ข้อมูลไม่ครบ', 'กรุณาถ่ายภาพบัตรประชาชนด้านหน้า'); }
                    if (idCardFrontDrop) idCardFrontDrop.style.borderColor = 'var(--danger-color)';
                 } else if (idCardFrontDrop) idCardFrontDrop.style.borderColor = '#bdbdbd';
                 if (!backFiles || backFiles.length === 0) {
                    isValid = false; if (showErrorOnFail && !firstInvalidElement) { firstInvalidElement = idCardBackDrop; showError('ข้อมูลไม่ครบ', 'กรุณาถ่ายภาพบัตรประชาชนด้านหลัง'); }
                    if (idCardBackDrop) idCardBackDrop.style.borderColor = 'var(--danger-color)';
                 } else if (idCardBackDrop) idCardBackDrop.style.borderColor = '#bdbdbd';

                 // 2. Check OCR ran and essential fields are filled
                 const idKycInput = document.getElementById('id-number-kyc');
                 if (isValid && (ocrResultDiv.classList.contains('hidden') || !idKycInput || !idKycInput.value)) {
                    isValid = false; if (showErrorOnFail && !firstInvalidElement) { firstInvalidElement = idCardFrontDrop; showError('ยังไม่ได้สแกนข้อมูล', 'กรุณารอสักครู่ให้ระบบสแกนข้อมูล หรือลองถ่ายภาพบัตรใหม่อีกครั้ง'); }
                 } else if (isValid && !ocrResultDiv.classList.contains('hidden')) {
                    const requiredOcrFields = ['firstname-th', 'lastname-th', 'birthdate-kyc', 'address-kyc', 'issue-date', 'expiry-date'];
                    for (const fieldId of requiredOcrFields) {
                        const input = document.getElementById(fieldId);
                        if (!input) { isValid = false; if (showErrorOnFail && !firstInvalidElement) firstInvalidElement = ocrResultDiv; break; }
                        if (!input.value.trim()) {
                            isValid = false;
                            if (showErrorOnFail && !firstInvalidElement) {
                                let labelText = `ข้อมูล "${fieldId}"`;
                                const labelElement = document.querySelector(`label[for="${fieldId}"] span`);
                                if (labelElement) labelText = `"${labelElement.textContent}"`;
                                showError('ข้อมูลไม่ครบถ้วน', `กรุณาตรวจสอบข้อมูล ${labelText} จากบัตรประชาชน`);
                                firstInvalidElement = input;
                            }
                            input.style.borderColor = 'var(--danger-color)';
                        } else {
                            if(input.style.borderColor !== 'var(--success-color)') input.style.borderColor = '#ccc'; // Reset if valid
                        }
                    }
                 }

                  if (!isValid && showErrorOnFail && firstInvalidElement) {
                      firstInvalidElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                      setTimeout(() => {
                        firstInvalidElement.focus();
                        shakeElement(firstInvalidElement.closest('.form-group') || firstInvalidElement.closest('.upload-area') || firstInvalidElement);
                      }, 300);
                  }
                 verifyIdCardBtn.disabled = !isValid; // Update button state based on validation
                 return isValid;
             }

            // Step 6: Face & Video Verification
             function resetStep6UI() {
                 faceCaptureSection.classList.remove('hidden');
                 startFaceCaptureBtn.classList.remove('hidden'); startFaceCaptureBtn.disabled = true; // Disable until webcam ready
                 retakeFaceCaptureBtn.classList.add('hidden'); retakeFaceCaptureBtn.disabled = true;
                 capturedFacesContainer.classList.add('hidden'); capturedFacesContainer.innerHTML = '';
                 faceGuideOverlay.classList.add('hidden'); faceActionText.classList.add('hidden'); faceCountdownText.classList.add('hidden');
                 document.querySelector('#face-capture-section .webcam-overlay').classList.add('show-overlay'); // Show initial overlay

                 videoRecordingSection.classList.add('hidden'); // Keep video section hidden initially
                 videoRecordingSection.classList.remove('active'); // Remove active class
                 recordingIndicator.classList.add('hidden');
                 recordingInstructionContainer.classList.remove('visible'); // Ensure instruction is hidden
                 startRecordingBtn.classList.remove('hidden'); startRecordingBtn.innerHTML = '<i class="fas fa-microphone"></i> เริ่มบันทึกวิดีโอ'; startRecordingBtn.disabled = true;
                 stopRecordingBtn.classList.add('hidden'); stopRecordingBtn.disabled = true;
                 videoPreviewContainer.classList.add('hidden');
                 if(videoPreview.src) URL.revokeObjectURL(videoPreview.src); videoPreview.src = '';
                 submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true;
                 submitKycBtn.innerHTML = 'ส่งข้อมูลเพื่อตรวจสอบ <i class="fas fa-paper-plane"></i>';
                 currentFaceActionIndex = 0; capturedFaces = []; recordedChunks = [];
                 if (mediaRecorder && mediaRecorder.state !== 'inactive') try { mediaRecorder.stop(); } catch (e) { console.warn("Error stopping media recorder during reset:", e); }
                 mediaRecorder = null;
                 if (faceCaptureTimeout) clearTimeout(faceCaptureTimeout); faceCaptureTimeout = null;
                 // Ensure stopWebcam was called if leaving step 6 previously
             }

            async function initWebcam() {
                // Don't reset UI here, reset is called on *entry* to step 6
                if (stream && stream.active) {
                    console.log("Webcam stream potentially active. Attempting reuse.");
                     try {
                        if (!videoElementFace.srcObject || !videoElementVideo.srcObject) {
                             videoElementFace.srcObject = stream; videoElementVideo.srcObject = stream;
                             await Promise.all([ videoElementFace.play(), videoElementVideo.play() ]);
                         } else if (videoElementFace.paused || videoElementVideo.paused) {
                             await Promise.all([ videoElementFace.play(), videoElementVideo.play() ]);
                         }
                        startFaceCaptureBtn.disabled = false; // Enable face capture
                        retakeFaceCaptureBtn.disabled = false; // Enable retake (if visible)
                        console.log("Webcam stream reused successfully.");
                        return;
                    } catch (playError) {
                        console.warn("Error reusing/playing existing stream. Re-initializing.", playError);
                        stopWebcamAndRecording(); // Clean up potentially broken stream
                    }
                }
                console.log("Initializing webcam...");
                startFaceCaptureBtn.disabled = true; // Disable buttons while initializing
                retakeFaceCaptureBtn.disabled = true;
                startRecordingBtn.disabled = true;
                stopRecordingBtn.disabled = true;
                 try {
                    stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' }, audio: true });
                    videoElementFace.srcObject = stream; videoElementVideo.srcObject = stream;
                    await Promise.all([
                        new Promise((res, rej) => { videoElementFace.onloadedmetadata = res; videoElementFace.onerror = rej; setTimeout(() => rej(new Error("Face video timeout")), 5000); }),
                        new Promise((res, rej) => { videoElementVideo.onloadedmetadata = res; videoElementVideo.onerror = rej; setTimeout(() => rej(new Error("Video video timeout")), 5000); })
                    ]);
                    await Promise.all([ videoElementFace.play(), videoElementVideo.play() ]);
                    console.log("Webcam stream initialized and playing.");
                    startFaceCaptureBtn.disabled = false; // Enable face capture button
                    retakeFaceCaptureBtn.disabled = false; // Enable retake
                    startRecordingBtn.disabled = true; // Keep video disabled initially
                 } catch (error) {
                    console.error('Error accessing/playing webcam/microphone:', error.name, error.message);
                    let errorMsg = 'กรุณาอนุญาตให้เบราว์เซอร์ใช้งานกล้องและไมโครโฟน';
                    if (error.name === 'NotAllowedError' || error.name === 'PermissionDeniedError') errorMsg = 'คุณไม่ได้อนุญาตให้ใช้งานกล้อง/ไมโครโฟน โปรดตรวจสอบการตั้งค่าเบราว์เซอร์';
                    else if (error.name === 'NotFoundError' || error.name === 'DevicesNotFoundError') errorMsg = 'ไม่พบกล้องหรือไมโครโฟนในอุปกรณ์ของคุณ';
                    else if (error.name === 'NotReadableError' || error.name === 'TrackStartError') errorMsg = 'กล้อง/ไมค์อาจถูกใช้งานโดยแอปอื่น หรือมีปัญหาทางฮาร์ดแวร์';
                    else if (error.name === 'OverconstrainedError') errorMsg = 'ไม่สามารถตั้งค่ากล้องตามที่ร้องขอได้';
                    else errorMsg = `เกิดข้อผิดพลาด: ${error.name || 'Unknown Error'}`;
                    showError('ไม่สามารถเข้าถึงกล้อง/ไมค์', errorMsg);
                    // Keep buttons disabled
                    startFaceCaptureBtn.disabled = true;
                    retakeFaceCaptureBtn.disabled = true;
                    startRecordingBtn.disabled = true;
                 }
            }

             function stopWebcamAndRecording() {
                console.log("Stopping webcam and recording resources...");
                 if (mediaRecorder && mediaRecorder.state !== 'inactive') { try { mediaRecorder.stop(); } catch (e) {} }
                 mediaRecorder = null;
                 if (stream) { stream.getTracks().forEach(track => { if (track.readyState === 'live') track.stop(); }); }
                 stream = null;
                 if(videoElementFace) videoElementFace.srcObject = null;
                 if(videoElementVideo) videoElementVideo.srcObject = null;
                 if (faceCaptureTimeout) { clearTimeout(faceCaptureTimeout); faceCaptureTimeout = null; }
                 console.log("Webcam resources released.");
            }

            function startFaceCaptureProcess() {
                 if (!stream || !stream.active || videoElementFace.readyState < videoElementFace.HAVE_ENOUGH_DATA) {
                    showError('กล้องยังไม่พร้อม', 'กรุณารอสักครู่ หรือตรวจสอบการอนุญาตใช้งานกล้อง');
                     initWebcam().then(() => { if (stream && stream.active) startFaceCaptureProcess(); }); // Attempt re-init
                    return;
                 }
                console.log("Starting face capture process...");
                document.querySelector('#face-capture-section .webcam-overlay').classList.remove('show-overlay'); // Hide initial overlay
                startFaceCaptureBtn.disabled = true; startFaceCaptureBtn.classList.add('hidden');
                retakeFaceCaptureBtn.classList.remove('hidden'); retakeFaceCaptureBtn.disabled = false;
                faceGuideOverlay.classList.remove('hidden');
                currentFaceActionIndex = 0; capturedFaces = [];
                capturedFacesContainer.innerHTML = ''; capturedFacesContainer.classList.add('hidden');
                runNextFaceAction();
            }

            function runNextFaceAction() {
                 if (!stream || !stream.active) { console.warn("Stream stopped mid-capture."); showError('เกิดข้อผิดพลาด', 'การเชื่อมต่อกล้องขัดข้อง'); retakeFaceCapture(); return; }
                 if (currentFaceActionIndex >= faceActions.length) { finishFaceCapture(); return; }
                 const action = faceActions[currentFaceActionIndex];
                 faceActionText.textContent = action.instruction; faceActionText.classList.remove('hidden');
                 let countdown = action.duration;
                 faceCountdownText.textContent = countdown; faceCountdownText.classList.remove('hidden');
                 if (faceCaptureTimeout) clearTimeout(faceCaptureTimeout);
                 const tick = () => {
                     if (!stream || !stream.active) { retakeFaceCapture(); return; }
                     countdown--;
                     faceCountdownText.textContent = countdown > 0 ? countdown : 'จับภาพ!';
                     if (countdown <= 0) captureFaceImage();
                     else faceCaptureTimeout = setTimeout(tick, 1000);
                 };
                 faceCaptureTimeout = setTimeout(tick, 1000);
            }

            function captureFaceImage() {
                if (!stream || !stream.active || !videoElementFace.videoWidth || videoElementFace.readyState < videoElementFace.HAVE_ENOUGH_DATA) {
                    console.error("Cannot capture face, stream/video not ready."); showError('เกิดข้อผิดพลาด', 'ไม่สามารถจับภาพใบหน้าได้'); retakeFaceCapture(); return;
                }
                 console.log(`Capturing face: ${faceActions[currentFaceActionIndex].instruction}`);
                 flashEffect.classList.add('flash'); setTimeout(() => flashEffect.classList.remove('flash'), 300);
                 const canvas = document.createElement('canvas');
                 canvas.width = videoElementFace.videoWidth; canvas.height = videoElementFace.videoHeight;
                 const ctx = canvas.getContext('2d');
                 ctx.translate(canvas.width, 0); ctx.scale(-1, 1); // Mirror
                 ctx.drawImage(videoElementFace, 0, 0, canvas.width, canvas.height);
                 ctx.setTransform(1, 0, 0, 1, 0, 0);
                 const imageData = canvas.toDataURL('image/jpeg', 0.8);
                 capturedFaces.push({ instruction: faceActions[currentFaceActionIndex].instruction, data: imageData });
                 currentFaceActionIndex++;
                 faceActionText.classList.add('hidden'); faceCountdownText.classList.add('hidden');
                 if (faceCaptureTimeout) clearTimeout(faceCaptureTimeout);
                 faceCaptureTimeout = setTimeout(runNextFaceAction, 700);
            }

             function displayCapturedFaces() {
                if (capturedFaces.length > 0) {
                    capturedFacesContainer.innerHTML = '';
                    capturedFaces.forEach(face => {
                        const faceCard = document.createElement('div'); faceCard.className = 'preview-card';
                        faceCard.innerHTML = `<img src="${face.data}" alt="ภาพใบหน้า: ${face.instruction}" class="preview-image" ><div class="preview-info"><p>${face.instruction}</p></div>`;
                        capturedFacesContainer.appendChild(faceCard);
                    });
                    capturedFacesContainer.classList.remove('hidden');
                }
            }

            function finishFaceCapture() {
                 console.log("Face capture finished.");
                 if (faceCaptureTimeout) clearTimeout(faceCaptureTimeout);
                 faceGuideOverlay.classList.add('hidden'); faceActionText.classList.add('hidden'); faceCountdownText.classList.add('hidden');
                 retakeFaceCaptureBtn.classList.add('hidden'); startFaceCaptureBtn.classList.add('hidden');
                 displayCapturedFaces();
                 setTimeout(() => {
                     faceCaptureSection.classList.add('hidden');
                     videoRecordingSection.classList.remove('hidden');
                     // Do NOT add 'active' class here yet, wait for recording start
                     videoRecordingSection.classList.remove('active');
                     recordingInstructionContainer.classList.remove('visible'); // Ensure instruction hidden initially
                     startRecordingBtn.disabled = false; // Enable video recording button
                     videoRecordingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                     if (stream && stream.active) {
                         if (videoElementVideo.srcObject !== stream) videoElementVideo.srcObject = stream;
                         if (videoElementVideo.paused) videoElementVideo.play().catch(e => console.error("Error playing video:", e));
                     } else { console.warn("Stream not active for video recording."); initWebcam(); } // Try re-init
                 }, 1500);
            }

            function retakeFaceCapture() {
                 console.log("Retaking face capture...");
                 if (faceCaptureTimeout) clearTimeout(faceCaptureTimeout);
                 // Don't stop webcam, just reset face UI
                 document.querySelector('#face-capture-section .webcam-overlay').classList.add('show-overlay');
                 startFaceCaptureBtn.classList.remove('hidden'); startFaceCaptureBtn.disabled = false;
                 retakeFaceCaptureBtn.classList.add('hidden'); retakeFaceCaptureBtn.disabled = true;
                 capturedFacesContainer.classList.add('hidden'); capturedFacesContainer.innerHTML = '';
                 faceGuideOverlay.classList.add('hidden'); faceActionText.classList.add('hidden'); faceCountdownText.classList.add('hidden');
                 videoRecordingSection.classList.add('hidden'); videoRecordingSection.classList.remove('active');
                 recordingInstructionContainer.classList.remove('visible');
                 startRecordingBtn.disabled = true; submitKycBtn.classList.add('hidden');
                 // Restart the process
                 // startFaceCaptureProcess(); // Don't auto-start, let user click again
            }

             // New function to show the instruction alert before starting recording
             function showRecordingInstructionAlert() {
                const instructionText = recordingInstruction.textContent.trim();
                Swal.fire({
                    title: 'คำแนะนำการบันทึกวิดีโอ',
                    html: `<p style="margin-bottom: 15px;">กรุณาอ่านออกเสียงข้อความต่อไปนี้ให้ชัดเจน:</p>
                           <p style="font-weight: bold; color: var(--primary-color); font-size: 1.1em; line-height: 1.5;">${instructionText}</p>`, // Added line-height
                    icon: 'info',
                    confirmButtonText: 'รับทราบและเริ่มบันทึก', // Clarified button text
                    confirmButtonColor: '#9c27b0',
                    allowOutsideClick: false,
                    showCancelButton: true, // Allow cancellation
                    cancelButtonText: 'ยกเลิก',
                    cancelButtonColor: '#757575',
                }).then((result) => {
                    if (result.isConfirmed) {
                        // User confirmed, proceed to start recording
                        startRecording();
                    } else {
                         // User cancelled, re-enable the button if needed (it should be enabled already unless clicked rapidly)
                         console.log("Video recording cancelled by user.");
                         startRecordingBtn.disabled = false;
                    }
                });
            }

             async function startRecording() {
                  // This function now runs AFTER the user confirms the SweetAlert
                  if (!stream || !stream.active || videoElementVideo.readyState < videoElementVideo.HAVE_ENOUGH_DATA) {
                     showError('กล้อง/ไมค์ไม่พร้อม', 'กรุณาตรวจสอบและอนุญาตการเข้าถึง หรือลองอีกครั้ง');
                     await initWebcam(); if (!stream || !stream.active) return;
                     // After re-init, might need to show the alert again or handle differently
                     // For now, just return and let the user click again if needed.
                     return;
                  }
                 console.log("Starting video recording...");
                 startRecordingBtn.disabled = true; recordedChunks = [];
                 videoPreviewContainer.classList.add('hidden');
                 if(videoPreview.src) URL.revokeObjectURL(videoPreview.src); videoPreview.src = '';
                 submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true;
                 try {
                     if (!window.MediaRecorder) { showError('เบราว์เซอร์ไม่รองรับ', 'เบราว์เซอร์ของคุณไม่รองรับการบันทึกวิดีโอ'); startRecordingBtn.disabled = false; return; }
                     const options = { mimeType: '' };
                     const MimeTypes = [ 'video/webm;codecs=vp9,opus', 'video/webm;codecs=vp8,opus', 'video/webm;codecs=h264,opus','video/webm;codecs=av1,opus', 'video/mp4;codecs=avc1.4d401e,mp4a.40.2', 'video/webm', 'video/mp4'];
                     for (let type of MimeTypes) { if (MediaRecorder.isTypeSupported(type)) { options.mimeType = type; break; } }
                     if (!options.mimeType) { console.warn("No preferred mimeType supported, using browser default."); delete options.mimeType; }
                     console.log("Using mimeType:", options.mimeType || 'Default');
                     mediaRecorder = new MediaRecorder(stream, options);
                     mediaRecorder.ondataavailable = (event) => { if (event.data && event.data.size > 0) recordedChunks.push(event.data); };
                     mediaRecorder.onstop = () => {
                         console.log("Recording stopped. Chunks:", recordedChunks.length);
                         recordingIndicator.classList.add('hidden');
                         videoRecordingSection.classList.remove('active'); // Ensure container is not 'active' visually
                         recordingInstructionContainer.classList.remove('visible'); // Hide instruction specifically
                         stopRecordingBtn.classList.add('hidden'); stopRecordingBtn.disabled = true;
                         startRecordingBtn.classList.remove('hidden'); startRecordingBtn.innerHTML = '<i class="fas fa-redo"></i> บันทึกวิดีโอใหม่'; startRecordingBtn.disabled = false;
                         if (recordedChunks.length === 0) { console.warn("No data recorded."); showError('บันทึกวิดีโอผิดพลาด', 'ไม่สามารถบันทึกข้อมูลวิดีโอได้'); submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true; return; }
                         const blobProperty = options.mimeType ? { type: options.mimeType } : undefined;
                         try {
                            const videoBlob = new Blob(recordedChunks, blobProperty);
                            if (videoBlob.size === 0) { console.error("Blob size 0."); showError('บันทึกวิดีโอผิดพลาด', 'ไฟล์วิดีโอมีขนาด 0'); submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true; return; }
                            const videoUrl = URL.createObjectURL(videoBlob);
                            videoPreview.src = videoUrl; videoPreviewContainer.classList.remove('hidden');
                            submitKycBtn.classList.remove('hidden'); submitKycBtn.disabled = false; // Enable submit
                            videoPreviewContainer.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                         } catch (blobError) { console.error("Blob creation error:", blobError); showError('เกิดข้อผิดพลาด', 'ไม่สามารถสร้างไฟล์วิดีโอได้'); submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true; }
                     };
                     mediaRecorder.onerror = (event) => {
                         console.error("MediaRecorder error:", event.error || event); let errorDetail = event.error ? `${event.error.name}: ${event.error.message}` : 'Unknown error'; showError('เกิดข้อผิดพลาดในการบันทึก', errorDetail);
                         recordingIndicator.classList.add('hidden'); videoRecordingSection.classList.remove('active'); recordingInstructionContainer.classList.remove('visible'); stopRecordingBtn.classList.add('hidden'); stopRecordingBtn.disabled = true; startRecordingBtn.classList.remove('hidden'); startRecordingBtn.disabled = false; submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true;
                     };
                     mediaRecorder.start(); console.log("Recording started.");
                     startRecordingBtn.classList.add('hidden'); stopRecordingBtn.classList.remove('hidden'); stopRecordingBtn.disabled = false;
                     recordingIndicator.classList.remove('hidden');
                     videoRecordingSection.classList.add('active'); // Show indicator
                     recordingInstructionContainer.classList.add('visible'); // Show instruction
                     submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true;
                 } catch (error) { console.error("Start recording error:", error); showError('เกิดข้อผิดพลาด', 'ไม่สามารถเริ่มบันทึกวิดีโอ: ' + error.message); videoRecordingSection.classList.remove('active'); recordingInstructionContainer.classList.remove('visible'); startRecordingBtn.disabled = false; }
             }

            function stopRecording() {
                console.log("Stop recording clicked.");
                stopRecordingBtn.disabled = true;
                if (mediaRecorder && mediaRecorder.state === 'recording') { try { mediaRecorder.stop(); } catch (e) { console.warn("Error calling stop:", e); /* UI reset in onstop/onerror */ } }
                else { console.warn("Stop called but not recording. State:", mediaRecorder?.state); stopRecordingBtn.classList.add('hidden'); stopRecordingBtn.disabled = true; startRecordingBtn.classList.remove('hidden'); startRecordingBtn.disabled = false; } // Reset UI if state is weird
            }

            function removeVideo() {
                 console.log("Removing video...");
                 if(videoPreview.src) { URL.revokeObjectURL(videoPreview.src); videoPreview.src = ''; }
                 videoPreviewContainer.classList.add('hidden'); recordedChunks = [];
                 submitKycBtn.classList.add('hidden'); submitKycBtn.disabled = true;
                 startRecordingBtn.innerHTML = '<i class="fas fa-microphone"></i> เริ่มบันทึกวิดีโอ';
                 startRecordingBtn.classList.remove('hidden'); startRecordingBtn.disabled = false;
                 stopRecordingBtn.classList.add('hidden'); stopRecordingBtn.disabled = true;
                 // Make sure instruction container is hidden again as recording needs to restart
                 recordingInstructionContainer.classList.remove('visible');
                 // videoRecordingSection should remain visible but not 'active'
                 videoRecordingSection.classList.remove('active');
            }

             // Helper: Convert Data URI to Blob
            function dataURItoBlob(dataURI) {
                try {
                    const byteString = atob(dataURI.split(',')[1]);
                    const mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];
                    const ab = new ArrayBuffer(byteString.length);
                    const ia = new Uint8Array(ab);
                    for (let i = 0; i < byteString.length; i++) {
                        ia[i] = byteString.charCodeAt(i);
                    }
                    return new Blob([ab], { type: mimeString });
                } catch (e) {
                    console.error("Error converting data URI to Blob:", e);
                    return null;
                }
            }

            function handleSubmitKyc() {
                 if (!validateStep6()) return;

                 submitKycBtn.disabled = true;
                 submitKycBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> กำลังส่ง...';
                 console.log("Submitting KYC Data (Simulation)...");

                 // --- Create FormData for submission ---
                 const formData = new FormData();
                 // Basic Info (Get from Step 3 inputs)
                 formData.append('phone', phoneInput.value);
                 formData.append('idNumber', idInput.value); // Original ID number entered by user
                 formData.append('birthDay', birthDaySelect.value);
                 formData.append('birthMonth', birthMonthSelect.value);
                 formData.append('birthYear', birthYearSelect.value);
                 formData.append('pin', pinCode); // WARNING: Sending PIN like this is insecure. Use secure handling.
                 formData.append('pdpa_consent', pdpaCheckbox.checked);
                 formData.append('marketing_consent', marketingCheckbox.checked); // Send marketing consent

                 // OCR Data (Get from Step 5 inputs)
                 ocrFieldsIds.forEach(id => {
                     const el = document.getElementById(id);
                     if(el) formData.append(`ocr_${id}`, el.value);
                 });
                  formData.append('ocr_birthDay', document.getElementById('birth-day-kyc').value);
                  formData.append('ocr_birthMonth', document.getElementById('birth-month-kyc').value);
                  formData.append('ocr_birthYear', document.getElementById('birth-year-kyc').value);

                 // ID Card Images
                 if (idCardFrontInput.files[0]) formData.append('id_card_front', idCardFrontInput.files[0], `id_front_${Date.now()}.jpg`);
                 if (idCardBackInput.files[0]) formData.append('id_card_back', idCardBackInput.files[0], `id_back_${Date.now()}.jpg`);

                 // Face Images
                 capturedFaces.forEach((face, index) => {
                    const faceBlob = dataURItoBlob(face.data);
                    if (faceBlob) formData.append(`face_image_${index}`, faceBlob, `face_${index}_${Date.now()}.jpg`);
                 });

                 // Video Recording
                 if (recordedChunks.length > 0) {
                    const mimeType = mediaRecorder?.mimeType || 'video/webm';
                    const videoBlob = new Blob(recordedChunks, { type: mimeType });
                    const fileExtension = mimeType.split('/')[1]?.split(';')[0] || 'webm';
                    const videoFileName = `verification_${Date.now()}.${fileExtension}`;
                    formData.append('verification_video', videoBlob, videoFileName);
                 }

                 // --- Simulate AJAX request ---
                 console.log("FormData prepared (excluding file content):");
                 for (let pair of formData.entries()) {
                     if (!(pair[1] instanceof File || pair[1] instanceof Blob)) {
                         console.log(pair[0] + ': ' + pair[1]);
                     } else {
                         console.log(pair[0] + ': [File/Blob Content]');
                     }
                 }

                 setTimeout(() => {
                     console.log("Submission simulation complete.");
                     cleanupResources(); // Stop webcam etc.
                     goToStep(totalLogicalSteps + 1, 'next'); // Go to success step
                 }, 2500); // Simulate network latency

                 // --- Real AJAX Request Example ---
                 /*
                 fetch('/api/submit-kyc', {
                     method: 'POST',
                     body: formData
                     // Add headers if needed (e.g., Authorization)
                 })
                 .then(response => {
                     if (!response.ok) {
                         // Try to read error response body
                         return response.text().then(text => {
                             throw new Error(`HTTP error! status: ${response.status}, message: ${text || 'No details'}`);
                         });
                     }
                     return response.json();
                 })
                 .then(data => {
                     console.log("Submission successful:", data);
                     cleanupResources();
                     goToStep(totalLogicalSteps + 1, 'next');
                 })
                 .catch(error => {
                     console.error("Submission error:", error);
                     showError('ส่งข้อมูลล้มเหลว', 'เกิดข้อผิดพลาดขณะส่งข้อมูล: ' + error.message);
                     submitKycBtn.disabled = false; // Re-enable button on failure
                     submitKycBtn.innerHTML = 'ส่งข้อมูลเพื่อตรวจสอบ <i class="fas fa-paper-plane"></i>';
                 });
                 */
            }

             function validateStep6() { // Final check before submit
                if (capturedFaces.length < faceActions.length) {
                    showError('ยังไม่บันทึกใบหน้า', 'กรุณาบันทึกภาพใบหน้าให้ครบทุกขั้นตอนก่อน');
                     // Optionally switch back to face capture section
                    faceCaptureSection.classList.remove('hidden');
                    videoRecordingSection.classList.add('hidden');
                    faceCaptureSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    retakeFaceCaptureBtn.focus();
                    return false;
                }
                if (recordedChunks.length === 0 || !videoPreview.src || videoPreview.readyState < 2) { // readyState 2: HAVE_METADATA or higher
                     showError('ยังไม่บันทึกวิดีโอ', 'กรุณาบันทึกวิดีโอการยืนยันตัวตนก่อน');
                     videoRecordingSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                     startRecordingBtn.focus();
                     return false;
                }
                return true;
            }

            // --- Utility Functions ---
            function showError(title, text) {
                if (Swal.isVisible()) Swal.close(); // Close loading indicator if open
                Swal.fire({ icon: 'error', title: title, text: text, confirmButtonColor: '#9c27b0', confirmButtonText: 'ตกลง' });
             }
            function showSuccess(title, text) { Swal.fire({ icon: 'success', title: title, text: text, timer: 2000, showConfirmButton: false }); }
            function shakeElement(element) { if (element) { element.classList.remove('shake'); void element.offsetWidth; element.classList.add('shake'); setTimeout(() => element.classList.remove('shake'), 500); } }

        });
    </script>
</body>
</html>
